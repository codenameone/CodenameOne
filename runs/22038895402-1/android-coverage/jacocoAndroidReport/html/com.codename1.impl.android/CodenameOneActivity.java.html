<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CodenameOneActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.codename1.impl.android</a> &gt; <span class="el_source">CodenameOneActivity.java</span></div><h1>CodenameOneActivity.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2008, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores
 * CA 94065 USA or visit www.oracle.com if you need additional information or
 * have any questions.
 */
package com.codename1.impl.android;

import android.app.Activity;
import android.app.PendingIntent;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.graphics.Bitmap;
import android.graphics.drawable.BitmapDrawable;
import android.os.Bundle;
import android.os.PowerManager;
import android.util.Log;
import android.view.Menu;
import android.view.MenuItem;
import android.view.Window;
import android.widget.Toast;

import com.codename1.payment.Product;
import com.codename1.ui.Command;
import com.codename1.ui.Display;
import com.codename1.ui.Form;
import com.codename1.ui.Image;
import com.codename1.ui.Toolbar;
import com.codename1.ui.events.ActionEvent;

import java.util.Arrays;
import java.util.List;
import java.util.Vector;

<span class="fc" id="L52">public class CodenameOneActivity extends Activity {</span>




    private Menu menu;
<span class="fc" id="L58">    private boolean nativeMenu = false;</span>
    private IntentResultListener intentResultListener;
    private IntentResultListener defaultResultListener;
    private boolean waitingForResult, waitingForPermissionResult;
    private boolean background;
<span class="fc" id="L63">    private Vector intentResult = new Vector();</span>
<span class="fc" id="L64">    boolean requestForPermission = false;</span>

    private IBillingSupport billingSupport;

    private PowerManager.WakeLock wakeLock;

    /**
     * Overriden by stub, returns the user application instance.
     */
    protected Object getApp() {
<span class="nc" id="L74">        return null;</span>
    }

    boolean wasPurchased(String item) {
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if (billingSupport != null) {</span>
<span class="nc" id="L79">            return billingSupport.wasPurchased(item);</span>
        }
<span class="nc" id="L81">        return false;</span>
    }

    void purchase(final String item) {
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (billingSupport != null) billingSupport.purchase(item);</span>
<span class="nc" id="L86">    }</span>


    void subscribe(final String item) {
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (billingSupport != null) billingSupport.subscribe(item);</span>
<span class="nc" id="L91">    }</span>


    protected IBillingSupport createBillingSupport() {
<span class="nc" id="L95">        return null;</span>
    }

    private IBillingSupport getBillingSupport() {
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (billingSupport == null) {</span>
<span class="nc" id="L100">            billingSupport = createBillingSupport();</span>
        }
<span class="nc" id="L102">        return billingSupport;</span>
    }


    @Override
    protected void onResume() {
<span class="fc" id="L108">        super.onResume();</span>
<span class="fc" id="L109">        AndroidImplementation.setActivity(this);</span>
<span class="fc" id="L110">        AndroidNativeUtil.onResume();</span>
<span class="pc bpc" id="L111" title="3 of 4 branches missed.">        if (isBillingEnabled() &amp;&amp; getBillingSupport() != null) {</span>
<span class="nc" id="L112">            billingSupport.consumeAndAcknowlegePurchases();</span>
        }
<span class="fc" id="L114">        background = false;</span>

        /*VERIFY-CODE-START
        verifySignature(&quot;EXPECTED_SIGNATURE_VALUE&quot;);
        VERIFY-CODE-END*/
<span class="fc" id="L119">    }</span>

    /*VERIFY-CODE-START
    private void verifySignature(String expectedSignature) {
        try {
            String[] split = expectedSignature.split(&quot;,&quot;);
            List&lt;String&gt; splitString = Arrays.asList(split);
            android.content.pm.PackageInfo packageInfo =
                    getPackageManager().getPackageInfo(getPackageName(),
                            PackageManager.GET_SIGNATURES);
            for (android.content.pm.Signature signature : packageInfo.signatures) {
                java.security.MessageDigest md = java.security.MessageDigest.getInstance(&quot;SHA&quot;);
                md.update(signature.toByteArray());
                String currentSignature = android.util.Base64.encodeToString(md.digest(), android.util.Base64.DEFAULT);
                if (!splitString.contains(currentSignature)) {
                    throw new RuntimeException(&quot;App integrity check failed for: &quot; + currentSignature);
                }
            }
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
    VERIFY-CODE-END*/

    /**
     * Overriden by subclasses to return true if billing is supported on this
     * build
     *
     * @return false
     */
    protected boolean isBillingEnabled() {
<span class="fc" id="L150">        return false;</span>
    }

    /**
     * Get the Android native Menu
     *
     * @return the Android Menu Object
     */
    public Menu getMenu() {
<span class="nc" id="L159">        return menu;</span>
    }

    /**
     * This method will enable the Android native Menu system instead of the
     * regular Form Menu.
     *
     * @param enable
     */
    public void enableNativeMenu(boolean enable) {
<span class="fc" id="L169">        nativeMenu = enable;</span>
<span class="fc" id="L170">    }</span>

    @Override
    public void onBackPressed() {
<span class="nc" id="L174">        Display.getInstance().keyPressed(AndroidImplementation.DROID_IMPL_KEY_BACK);</span>
<span class="nc" id="L175">        Display.getInstance().keyReleased(AndroidImplementation.DROID_IMPL_KEY_BACK);</span>
<span class="nc" id="L176">    }</span>
    
    @Override
    public void onCreate(Bundle savedInstanceState) {
<span class="fc" id="L180">        super.onCreate(savedInstanceState);</span>
<span class="fc" id="L181">        AndroidImplementation.setActivity(this);</span>
<span class="fc" id="L182">        AndroidNativeUtil.onCreate(savedInstanceState);</span>

<span class="pc bpc" id="L184" title="1 of 2 branches missed.">        if (android.os.Build.VERSION.SDK_INT &gt;= 11) {</span>
<span class="fc" id="L185">            getWindow().requestFeature(Window.FEATURE_ACTION_BAR);</span>
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">            if (getActionBar() != null) {</span>
<span class="fc" id="L187">                getActionBar().hide();</span>
            }
        }

        try {
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">            if (isBillingEnabled()) {</span>
<span class="nc" id="L193">                String k = getBase64EncodedPublicKey();</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">                if(k.length() == 0){</span>
<span class="nc" id="L195">                    Log.e(&quot;Codename One&quot;, &quot;android.licenseKey base64 is not configured&quot;);</span>
                }
<span class="nc" id="L197">                getBillingSupport().initBilling();</span>


            }
<span class="nc" id="L201">        } catch (Throwable t) {</span>
            // might happen if billing permissions are missing
<span class="nc" id="L203">            System.out.print(&quot;This exception is totally valid and here only for debugging purposes&quot;);</span>
<span class="nc" id="L204">            t.printStackTrace();</span>
<span class="fc" id="L205">        }</span>
<span class="fc" id="L206">    }</span>

    @Override
    protected void onStart() {
<span class="fc" id="L210">        super.onStart();</span>
<span class="fc" id="L211">    }</span>

    @Override
    protected void onStop() {
<span class="fc" id="L215">        AndroidImplementation.clearAppArg();</span>
<span class="fc" id="L216">        super.onStop();</span>
<span class="fc" id="L217">        background = true;</span>
<span class="fc" id="L218">        unlockScreen();</span>
<span class="fc" id="L219">    }</span>

    @Override
    protected void onDestroy() {
<span class="fc" id="L223">        super.onDestroy();</span>
<span class="fc" id="L224">        AndroidNativeUtil.onDestroy();</span>
<span class="pc bpc" id="L225" title="1 of 2 branches missed.">        if (isBillingEnabled()) {</span>
<span class="nc" id="L226">            getBillingSupport().onDestroy();</span>
        }
<span class="fc" id="L228">        unlockScreen();</span>
<span class="fc" id="L229">    }</span>

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
<span class="fc" id="L233">        super.onCreateOptionsMenu(menu);</span>
<span class="fc" id="L234">        this.menu = menu;</span>
        // By returning true we signal let Android know that we want the menu
        // to be displayed
<span class="pc bpc" id="L237" title="5 of 6 branches missed.">        return nativeMenu &amp;&amp; Display.isInitialized() &amp;&amp; Display.getInstance().getCurrent() != null;</span>
    }

    @Override
    protected void onSaveInstanceState(Bundle outState) {
<span class="nc" id="L242">        super.onSaveInstanceState(outState);</span>
<span class="nc" id="L243">        AndroidNativeUtil.onSaveInstanceState(outState);</span>
<span class="nc" id="L244">    }</span>
    
    @Override
    protected void onNewIntent(Intent intent) {
<span class="nc" id="L248">        super.onNewIntent(intent);</span>
<span class="nc" id="L249">        setIntent(intent);</span>
<span class="nc" id="L250">    }</span>
    
    @Override
    public void onLowMemory() {
<span class="nc" id="L254">        super.onLowMemory();</span>
<span class="nc" id="L255">        AndroidNativeUtil.onLowMemory();</span>
<span class="nc" id="L256">    }</span>

    @Override
    protected void onPause() {
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">        if (InPlaceEditView.isEditing()) {</span>
<span class="fc" id="L261">            AndroidImplementation.stopEditing(true);</span>
        }
<span class="fc" id="L263">        super.onPause();</span>
<span class="fc" id="L264">        AndroidNativeUtil.onPause();</span>
<span class="fc" id="L265">    }</span>

    @Override
    public boolean onPrepareOptionsMenu(Menu menu) {
<span class="nc" id="L269">        super.onPrepareOptionsMenu(menu);</span>

<span class="nc" id="L271">        menu.clear();</span>

        try {
<span class="nc" id="L274">            Form currentForm = Display.getInstance().getCurrent();</span>
<span class="nc bnc" id="L275" title="All 4 branches missed.">            if (currentForm == null || Toolbar.isGlobalToolbar()) {</span>
<span class="nc" id="L276">                return false;</span>
            }

<span class="nc" id="L279">            int numCommands = currentForm.getCommandCount();</span>

            // If there are no commands, there's nothing to put in the menu
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (numCommands == 0) {</span>
<span class="nc" id="L283">                return false;</span>
            }

            // Build menu items from commands
<span class="nc bnc" id="L287" title="All 2 branches missed.">            for (int n = 0; n &lt; numCommands; n++) {</span>
<span class="nc" id="L288">                Command command = currentForm.getCommand(n);</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">                if (command != null) {</span>
<span class="nc" id="L290">                    String txt = currentForm.getUIManager().localize(command.getCommandName(), command.getCommandName());</span>
<span class="nc" id="L291">                    MenuItem item = menu.add(Menu.NONE, n, Menu.NONE, txt);</span>

<span class="nc" id="L293">                    Image icon = command.getIcon();</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">                    if (icon != null) {</span>
<span class="nc" id="L295">                        Bitmap b = (Bitmap) icon.getImage();</span>
                        // Using BitmapDrawable with resources, to use device density (from 1.6 and above).
<span class="nc" id="L297">                        BitmapDrawable d = new BitmapDrawable(getResources(), b);</span>
<span class="nc" id="L298">                        item.setIcon(d);</span>
                    }
<span class="nc bnc" id="L300" title="All 2 branches missed.">                    if (!command.isEnabled()) {</span>
<span class="nc" id="L301">                        item.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L303" title="All 4 branches missed.">                    if (android.os.Build.VERSION.SDK_INT &gt;= 11 &amp;&amp; command.getClientProperty(&quot;android:showAsAction&quot;) != null) {</span>
<span class="nc" id="L304">                        String androidShowAsAction = command.getClientProperty(&quot;android:showAsAction&quot;).toString();</span>
                        // From https://developer.android.com/guide/topics/resources/menu-resource.html
                        // &quot;ifRoom&quot; | &quot;never&quot; | &quot;withText&quot; | &quot;always&quot; | &quot;collapseActionView&quot;
<span class="nc bnc" id="L307" title="All 2 branches missed.">                        if (androidShowAsAction.equalsIgnoreCase(&quot;ifRoom&quot;)) {</span>
<span class="nc" id="L308">                            item.setShowAsAction(MenuItem.SHOW_AS_ACTION_IF_ROOM);</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                        } else if (androidShowAsAction.equalsIgnoreCase(&quot;never&quot;)) {</span>
<span class="nc" id="L310">                            item.setShowAsAction(MenuItem.SHOW_AS_ACTION_NEVER);</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                        } else if (androidShowAsAction.equalsIgnoreCase(&quot;withText&quot;)) {</span>
<span class="nc" id="L312">                            item.setShowAsAction(MenuItem.SHOW_AS_ACTION_IF_ROOM | MenuItem.SHOW_AS_ACTION_WITH_TEXT);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                        } else if (androidShowAsAction.equalsIgnoreCase(&quot;always&quot;)) {</span>
<span class="nc" id="L314">                            item.setShowAsAction(MenuItem.SHOW_AS_ACTION_ALWAYS);</span>
<span class="nc bnc" id="L315" title="All 4 branches missed.">                        } else if (android.os.Build.VERSION.SDK_INT &gt;= 14 &amp;&amp; androidShowAsAction.equalsIgnoreCase(&quot;collapseActionView&quot;)) {</span>
<span class="nc" id="L316">                            item.setShowAsAction(8); //MenuItem.SHOW_AS_ACTION_COLLAPSE_ACTION_VIEW</span>
                        }
                    }
                }
            }
<span class="nc" id="L321">        } catch (Throwable t) {</span>
<span class="nc" id="L322">        }</span>

<span class="nc" id="L324">        return nativeMenu;</span>
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc" id="L329">        super.onOptionsItemSelected(item);</span>

<span class="nc" id="L331">        final Form currentForm = Display.getInstance().getCurrent();</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">        if (currentForm == null) {</span>
<span class="nc" id="L333">            return false;</span>
        }
<span class="nc" id="L335">        Command cmd = null;</span>
<span class="nc" id="L336">        final boolean[] tmpProp = new boolean[1];</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">        if (item.getItemId() == android.R.id.home) {</span>
<span class="nc" id="L338">            cmd = currentForm.getBackCommand();</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">            if (cmd == null) {</span>
<span class="nc" id="L340">                return false;</span>
            }
<span class="nc" id="L342">            cmd.putClientProperty(&quot;source&quot;, &quot;ActionBar&quot;);</span>
<span class="nc" id="L343">            tmpProp[0] = true;</span>
        }

<span class="nc" id="L346">        int commandIndex = item.getItemId();</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (cmd == null) {</span>
<span class="nc" id="L348">            cmd = currentForm.getCommand(commandIndex);</span>
        }
<span class="nc" id="L350">        final Command command = cmd;</span>
<span class="nc" id="L351">        final ActionEvent actionEvent = new ActionEvent(command);</span>

        //stop edit if the keybaord is open
<span class="nc" id="L354">        AndroidImplementation.stopEditing();</span>
        // Protect ourselves from commands that misbehave. A crash here will crash the entire application
<span class="nc" id="L356">        Display.getInstance().callSerially(new Runnable() {</span>
            @Override
            public void run() {
                try {
<span class="nc" id="L360">                    currentForm.dispatchCommand(command, actionEvent);</span>
                    //remove the temp source property
<span class="nc bnc" id="L362" title="All 2 branches missed.">                    if (tmpProp[0]) {</span>
<span class="nc" id="L363">                        command.putClientProperty(&quot;source&quot;, null);</span>
                    }
<span class="nc" id="L365">                } catch (Throwable e) {</span>
<span class="nc" id="L366">                    Log.e(&quot;CodenameOneActivity.onOptionsItemSelected&quot;, e.toString() + Log.getStackTraceString(e));</span>
<span class="nc" id="L367">                }</span>
<span class="nc" id="L368">            }</span>
        });

<span class="nc" id="L371">        return true;</span>
    }

    protected void fireIntentResult() {
<span class="nc bnc" id="L375" title="All 2 branches missed.">        if (intentResult.size() &gt; 0) {</span>
<span class="nc" id="L376">            final IntentResult response = (IntentResult) intentResult.get(0);</span>
<span class="nc bnc" id="L377" title="All 4 branches missed.">            if (intentResultListener != null &amp;&amp; response != null) {</span>
<span class="nc" id="L378">                Display.getInstance().callSerially(new Runnable() {</span>

                    @Override
                    public void run() {
<span class="nc" id="L382">                        intentResultListener.onActivityResult(response.getRequestCode(),</span>
<span class="nc" id="L383">                                response.getResultCode(),</span>
<span class="nc" id="L384">                                response.getData());</span>
<span class="nc" id="L385">                    }</span>
                });
            }
        }
<span class="nc" id="L389">    }</span>

    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
<span class="nc" id="L392">        super.onActivityResult(requestCode, resultCode, data);</span>
<span class="nc" id="L393">        IntentResult response = new IntentResult(requestCode, resultCode, data);</span>
<span class="nc" id="L394">        intentResult.add(response);</span>
<span class="nc" id="L395">    }</span>

    public void setIntentResultListener(IntentResultListener l) {
        //if the activity is waiting for result don't override the intent listener
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">        if(waitingForResult){</span>
<span class="nc" id="L400">            return;</span>
        }
<span class="fc" id="L402">        this.intentResultListener = l;</span>
<span class="pc bpc" id="L403" title="2 of 4 branches missed.">        if (l != null &amp;&amp; l != defaultResultListener) {</span>
<span class="nc" id="L404">            waitingForResult = true;</span>
        }
<span class="fc" id="L406">    }</span>

    public void setDefaultIntentResultListener(IntentResultListener l) {
<span class="fc" id="L409">        this.defaultResultListener = l;</span>
<span class="fc" id="L410">    }</span>

    public void restoreIntentResultListener() {
<span class="nc" id="L413">        waitingForResult = false;</span>
<span class="nc" id="L414">        setIntentResultListener(defaultResultListener);</span>
<span class="nc" id="L415">    }</span>

    @Override
    public void startActivityForResult(Intent intent, int requestCode) {
<span class="nc" id="L419">        Bundle extra = intent.getExtras();</span>
<span class="nc bnc" id="L420" title="All 6 branches missed.">        if(extra != null &amp;&amp; extra.containsKey(&quot;WaitForResult&quot;) &amp;&amp; !extra.getBoolean(&quot;WaitForResult&quot;)){</span>
<span class="nc" id="L421">            waitingForResult = false;            </span>
        }else{
<span class="nc" id="L423">            waitingForResult = true;</span>
        }
<span class="nc" id="L425">        intentResult = new Vector();</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">        if (InPlaceEditView.isEditing()) {</span>
<span class="nc" id="L427">            AndroidImplementation.stopEditing(true);</span>
        }
<span class="nc" id="L429">        super.startActivityForResult(intent, requestCode);</span>
<span class="nc" id="L430">    }</span>

    @Override
    public void startActivity(Intent intent) {
<span class="nc" id="L434">        Bundle extra = intent.getExtras();</span>
<span class="nc bnc" id="L435" title="All 6 branches missed.">        if(extra != null &amp;&amp; extra.containsKey(&quot;WaitForResult&quot;) &amp;&amp; !extra.getBoolean(&quot;WaitForResult&quot;)){</span>
<span class="nc" id="L436">            waitingForResult = false;            </span>
        }else{
<span class="nc" id="L438">            waitingForResult = true;</span>
        }
<span class="nc bnc" id="L440" title="All 2 branches missed.">        if (InPlaceEditView.isEditing()) {</span>
<span class="nc" id="L441">            AndroidImplementation.stopEditing(true);</span>
        }
<span class="nc" id="L443">        super.startActivity(intent);</span>
<span class="nc" id="L444">    }</span>

    public boolean isWaitingForResult() {
<span class="fc" id="L447">        return waitingForResult;</span>
    }

    protected void setWaitingForResult(boolean waitingForResult) {
<span class="nc" id="L451">        this.waitingForResult = waitingForResult;</span>
<span class="nc" id="L452">    }</span>

    public boolean isBackground() {
<span class="fc" id="L455">        return background;</span>
    }

    public void registerForPush(String key) {
<span class="nc" id="L459">        Intent registrationIntent = new Intent(&quot;com.google.android.c2dm.intent.REGISTER&quot;);</span>
<span class="nc" id="L460">        registrationIntent.setPackage(&quot;com.google.android.gms&quot;);</span>
<span class="nc" id="L461">        registrationIntent.putExtra(&quot;app&quot;, AndroidImplementation.getBroadcastPendingIntent(this, 0, new Intent())); // boilerplate</span>
<span class="nc" id="L462">        registrationIntent.putExtra(&quot;sender&quot;, key);</span>
<span class="nc" id="L463">        startService(registrationIntent);</span>
<span class="nc" id="L464">    }</span>

    public void stopReceivingPush() {
<span class="nc" id="L467">        Intent unregIntent = new Intent(&quot;com.google.android.c2dm.intent.UNREGISTER&quot;);</span>
<span class="nc" id="L468">        unregIntent.setPackage(&quot;com.google.android.gms&quot;);</span>
<span class="nc" id="L469">        unregIntent.putExtra(&quot;app&quot;, AndroidImplementation.getBroadcastPendingIntent(this, 0, new Intent()));</span>
<span class="nc" id="L470">        startService(unregIntent);</span>
<span class="nc" id="L471">    }</span>

    public void lockScreen() {
<span class="nc" id="L474">        unlockScreen();</span>
        try {
<span class="nc" id="L476">            android.os.PowerManager pm = (android.os.PowerManager) getSystemService(android.content.Context.POWER_SERVICE);</span>
<span class="nc" id="L477">            wakeLock = pm.newWakeLock(android.os.PowerManager.SCREEN_BRIGHT_WAKE_LOCK | android.os.PowerManager.ACQUIRE_CAUSES_WAKEUP | android.os.PowerManager.ON_AFTER_RELEASE, &quot;Codename One&quot;);</span>
<span class="nc" id="L478">        } catch (Exception excp) {</span>
<span class="nc" id="L479">            excp.printStackTrace();</span>
<span class="nc" id="L480">        }</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (wakeLock != null) {</span>
<span class="nc" id="L482">            wakeLock.acquire();</span>
        }
<span class="nc" id="L484">    }</span>

    public void unlockScreen() {
<span class="pc bpc" id="L487" title="3 of 4 branches missed.">        if (wakeLock != null &amp;&amp; wakeLock.isHeld()) {</span>
<span class="nc" id="L488">            wakeLock.release();</span>
<span class="nc" id="L489">            wakeLock = null;</span>
        }
<span class="fc" id="L491">    }</span>

    public String getBase64EncodedPublicKey() {
<span class="nc" id="L494">        String key = Display.getInstance().getProperty(&quot;android.licenseKey&quot;, &quot;&quot;);        </span>
<span class="nc" id="L495">        return key;</span>
    }



    String getPayload() {
<span class="nc" id="L501">        return &quot;&quot;;</span>
    }







    public boolean isConsumable(String item) {
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (getBillingSupport() != null) {</span>
<span class="nc" id="L512">            return getBillingSupport().isConsumable(item);</span>
        }
<span class="nc" id="L514">        return false;</span>
    }

    Product[] getProducts(String[] skus){
<span class="nc bnc" id="L518" title="All 2 branches missed.">        if (getBillingSupport() != null) {</span>
<span class="nc" id="L519">            return getBillingSupport().getProducts(skus, false);</span>
        }
<span class="nc" id="L521">        return new Product[0];</span>
    }
    

    


    public void setRequestForPermission(boolean requestForPermission) {
<span class="nc" id="L529">        this.requestForPermission = requestForPermission;</span>
<span class="nc" id="L530">    }</span>

    public void setWaitingForPermissionResult(boolean waitingForPermissionResult) {
<span class="nc" id="L533">        this.waitingForPermissionResult = waitingForPermissionResult;</span>
<span class="nc" id="L534">    }</span>

    public boolean isWaitingForPermissionResult() {
<span class="fc" id="L537">        return waitingForPermissionResult;</span>
    }

    public boolean isRequestForPermission() {
<span class="nc" id="L541">        return requestForPermission;</span>
    }

    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
<span class="nc bnc" id="L545" title="All 4 branches missed.">        if(grantResults != null || grantResults.length == 0) {</span>
<span class="nc" id="L546">            requestForPermission = false;</span>
<span class="nc" id="L547">            return;</span>
        }
<span class="nc bnc" id="L549" title="All 2 branches missed.">        if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {</span>
<span class="nc" id="L550">            Log.i(&quot;Codename One&quot;, &quot;PERMISSION_GRANTED&quot;);</span>
        } else {
            // Permission Denied
<span class="nc" id="L553">            Toast.makeText(this, &quot;Permission is denied&quot;, Toast.LENGTH_SHORT).show();</span>
        }
<span class="nc" id="L555">        requestForPermission = false;</span>
<span class="nc" id="L556">    }</span>
    
    public boolean hasUI(){
<span class="fc" id="L559">        return true;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>