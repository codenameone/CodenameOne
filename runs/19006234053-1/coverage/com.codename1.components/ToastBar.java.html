<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ToastBar.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">codenameone-core-unittests</a> &gt; <a href="index.source.html" class="el_package">com.codename1.components</a> &gt; <span class="el_source">ToastBar.java</span></div><h1>ToastBar.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2012, Codename One and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Codename One designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Codename One through http://www.codenameone.com/ if you
 * need additional information or have any questions.
 */
package com.codename1.components;

import com.codename1.io.ConnectionRequest;
import com.codename1.io.NetworkEvent;
import com.codename1.io.NetworkManager;
import com.codename1.ui.Button;
import com.codename1.ui.Component;
import com.codename1.ui.Container;
import com.codename1.ui.Dialog;
import com.codename1.ui.Display;
import com.codename1.ui.FontImage;
import com.codename1.ui.Form;
import com.codename1.ui.Image;
import com.codename1.ui.Label;
import com.codename1.ui.Slider;
import com.codename1.ui.TextArea;
import com.codename1.ui.animations.CommonTransitions;
import com.codename1.ui.events.ActionEvent;
import com.codename1.ui.events.ActionListener;
import com.codename1.ui.geom.Dimension;
import com.codename1.ui.geom.Rectangle;
import com.codename1.ui.layouts.BorderLayout;
import com.codename1.ui.plaf.Style;
import com.codename1.ui.plaf.UIManager;
import com.codename1.util.FailureCallback;
import com.codename1.util.SuccessCallback;

import java.util.ArrayList;
import java.util.Timer;
import java.util.TimerTask;

import static com.codename1.ui.ComponentSelector.$;

/**
 * An API to present status messages to the user in an unobtrusive manner.  This is useful if
 * there are background tasks that need to display information to the user.  E.g. If a network request fails,
 * of let the user know that &quot;Jobs are being synchronized&quot;.
 *
 * &lt;h2&gt;Example Usage&lt;/h2&gt;
 *
 * &lt;script src=&quot;https://gist.github.com/codenameone/4584f342783169899b34.js&quot;&gt;&lt;/script&gt;
 *
 * &lt;h3&gt;Advanced Usage&lt;/h3&gt;
 * &lt;p&gt;See the &lt;a href=&quot;https://github.com/codenameone/codenameone-demos/blob/master/ToastBarDemo/src/com/codename1/demos/status/ToastBarDemo.java&quot;&gt;StatusBarDemo&lt;/a&gt;&lt;/p&gt;
 *
 * &lt;h2&gt;Screenshots&lt;/h2&gt;
 *
 * &lt;h3&gt;Status With Progress Bar&lt;/h3&gt;
 * &lt;img src=&quot;https://www.codenameone.com/img/developer-guide/components-statusbar.png&quot; alt=&quot;Status With Progress Bar&quot; /&gt;
 *
 * &lt;h3&gt;Status With Multi-Line Message&lt;/h3&gt;
 * &lt;img src=&quot;https://www.codenameone.com/img/developer-guide/components-statusbar-multiline.png&quot; alt=&quot;Status With Multi-Line Message&quot; /&gt;
 *
 * &lt;h2&gt;Video Demo&lt;/h2&gt;
 * &lt;iframe width=&quot;640&quot; height=&quot;480&quot; src=&quot;https://www.youtube.com/embed/SMhqQ1xvfz0?rel=0&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
 * &lt;p&gt;
 * Note: the video above refers to the {@code ToastBar} based on its development name of StatusBar. This
 * was changed to avoid confusion with the iOS StatusBar.
 * &lt;/p&gt;
 *
 * @author shannah
 */
public class ToastBar {

    /**
     * The default timeout for info/error messages
     */
<span class="nc" id="L90">    private static int defaultMessageTimeout = 4000;</span>
    private static ToastBar instance;
    /**
     * Keeps track of the currently active status messages.
     */
<span class="nc" id="L95">    private final ArrayList&lt;Status&gt; statuses = new ArrayList&lt;Status&gt;();</span>
<span class="nc" id="L96">    private int position = Component.BOTTOM;</span>

    /**
     * The default UIID that to be used for the {@code ToastBar} component.  This is the
     * style of the box that appears at the bottom of the screen.
     */
<span class="nc" id="L102">    private String defaultUIID = &quot;ToastBar&quot;;</span>

    /**
     * The default UIID that is to be used for the text in the {@code ToastBar}.
     */
<span class="nc" id="L107">    private String defaultMessageUIID = &quot;ToastBarMessage&quot;;</span>


    //FIXME SH Need to style the {@code ToastBar} so that it looks nicer
    private boolean useFormLayeredPane;
    /**
     * Flag to indicate that the status is updating.  This is used to prevent
     * two status updates from happening at the same time.
     */
    private boolean updatingStatus;
    /**
     * Flag to indicate that a request to update the status was received while
     * updateStatus() was running.
     */
    private boolean pendingUpdateStatus;

<span class="nc" id="L123">    private ToastBar() {</span>

<span class="nc" id="L125">    }</span>

    /**
     * The default timeout for info/error messages
     *
     * @return the defaultMessageTimeout
     */
    public static int getDefaultMessageTimeout() {
<span class="nc" id="L133">        return defaultMessageTimeout;</span>
    }

    /**
     * The default timeout for info/error messages
     *
     * @param aDefaultMessageTimeout the defaultMessageTimeout to set
     */
    public static void setDefaultMessageTimeout(int aDefaultMessageTimeout) {
<span class="nc" id="L142">        defaultMessageTimeout = aDefaultMessageTimeout;</span>
<span class="nc" id="L143">    }</span>

    /**
     * Gets reference to the singleton StatusBar instance
     *
     * @return
     */
    public static ToastBar getInstance() {
<span class="nc bnc" id="L151" title="All 2 branches missed.">        if (instance == null) {</span>
<span class="nc" id="L152">            instance = new ToastBar();</span>

        }
<span class="nc" id="L155">        return instance;</span>
    }

    /**
     * Simplifies a common use case of showing an error message with an error icon that fades out after a few seconds
     *
     * @param msg the error message
     */
    public static void showErrorMessage(String msg) {
<span class="nc" id="L164">        showErrorMessage(msg, defaultMessageTimeout);</span>
<span class="nc" id="L165">    }</span>

    /**
     * Simplifies a common use case of showing a message with an icon that fades out after a few seconds
     *
     * @param msg      the message
     * @param icon     the material icon to show from {@link com.codename1.ui.FontImage}
     * @param timeout  the timeout value in milliseconds
     * @param listener the action to perform when the ToastBar is tapped
     * @return the status if we want to clear it before timeout elapses
     */
    public static Status showMessage(String msg, char icon, int timeout, ActionListener listener) {
<span class="nc" id="L177">        Status s = ToastBar.getInstance().createStatus();</span>
<span class="nc" id="L178">        Style stl = UIManager.getInstance().getComponentStyle(s.getMessageUIID());</span>
<span class="nc" id="L179">        s.setIcon(FontImage.createMaterial(icon, stl, 4));</span>
<span class="nc" id="L180">        s.setMessage(msg);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (listener != null) {</span>
<span class="nc" id="L182">            s.setListener(listener);</span>
        }
<span class="nc" id="L184">        s.setExpires(timeout);</span>
<span class="nc" id="L185">        s.show();</span>
<span class="nc" id="L186">        return s;</span>
    }

    /**
     * Simplifies a common use case of showing a message with an icon that fades out after a few seconds
     *
     * @param msg     the message
     * @param icon    the material icon to show from {@link com.codename1.ui.FontImage}
     * @param timeout the timeout value in milliseconds
     * @return the status if we want to clear it before timeout elapses
     */
    public static Status showMessage(String msg, char icon, int timeout) {
<span class="nc" id="L198">        return showMessage(msg, icon, timeout, null);</span>
    }

    /**
     * Simplifies a common use case of showing an error message with an error icon that fades out after a few seconds
     *
     * @param msg      the message
     * @param icon     the material icon to show from {@link com.codename1.ui.FontImage}
     * @param listener the action to perform when the ToastBar is tapped
     * @return the status if we want to clear it before timeout elapses
     */
    public static Status showMessage(String msg, char icon, ActionListener listener) {
<span class="nc" id="L210">        return showMessage(msg, icon, defaultMessageTimeout, listener);</span>
    }

    /**
     * Simplifies a common use case of showing an error message with an error icon that fades out after a few seconds
     *
     * @param icon the material icon to show from {@link com.codename1.ui.FontImage}
     * @param msg  the message
     * @return the status if we want to clear it before timeout elapses
     */
    public static Status showMessage(String msg, char icon) {
<span class="nc" id="L221">        return showMessage(msg, icon, defaultMessageTimeout);</span>
    }

    /**
     * Simplifies a common use case of showing an information message with an info icon that fades out after a few seconds
     *
     * @param msg the message
     * @return the status if we want to clear it before timeout elapses
     */
    public static Status showInfoMessage(String msg) {
<span class="nc" id="L231">        return showMessage(msg, FontImage.MATERIAL_INFO, defaultMessageTimeout);</span>
    }

    /**
     * Simplifies a common use case of showing an error message with an error icon that fades out after a few seconds
     *
     * @param msg     the error message
     * @param timeout the timeout value in milliseconds
     * @return the status if we want to clear it before timeout elapses
     */
    public static Status showErrorMessage(String msg, int timeout) {
<span class="nc" id="L242">        return showMessage(msg, FontImage.MATERIAL_ERROR, timeout);</span>
    }

    /*
     * Shows a progress indicator based on connection request, this is incomplete but it meant to serve as
     * a replacement for the inifinte progress
     *
     * @param message a message to show on the progress indicator
     * @param cr the connection request whose progress should be shown
     * @param onSuccess invoked when the connection request completes, can be null
     * @param onError invoked on case of an error, can be null
     */
    public static void showConnectionProgress(String message, final ConnectionRequest cr,
                                              final SuccessCallback&lt;NetworkEvent&gt; onSuccess, final FailureCallback&lt;NetworkEvent&gt; onError) {
<span class="nc" id="L256">        final ToastBar.Status s = ToastBar.getInstance().createStatus();</span>
<span class="nc" id="L257">        s.setProgress(-1);</span>
<span class="nc" id="L258">        s.setMessage(message);</span>
<span class="nc" id="L259">        s.show();</span>
<span class="nc" id="L260">        final ActionListener[] progListener = new ActionListener[1];</span>
<span class="nc" id="L261">        final ActionListener&lt;NetworkEvent&gt; errorListener = new ActionListener&lt;NetworkEvent&gt;() {</span>
            public void actionPerformed(NetworkEvent evt) {
<span class="nc" id="L263">                s.clear();</span>
<span class="nc" id="L264">                NetworkManager.getInstance().removeErrorListener(this);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                if (progListener[0] != null) {</span>
<span class="nc" id="L266">                    NetworkManager.getInstance().removeProgressListener(progListener[0]);</span>
                }
<span class="nc bnc" id="L268" title="All 2 branches missed.">                if (onError != null) {</span>
<span class="nc" id="L269">                    onError.onError(cr, evt.getError(), evt.getResponseCode(), evt.getMessage());</span>
                }
<span class="nc" id="L271">            }</span>
        };
<span class="nc" id="L273">        NetworkManager.getInstance().addErrorListener(errorListener);</span>
<span class="nc" id="L274">        progListener[0] = new ActionListener&lt;NetworkEvent&gt;() {</span>
            private int soFar;

            public void actionPerformed(NetworkEvent evt) {
<span class="nc bnc" id="L278" title="All 3 branches missed.">                switch (evt.getProgressType()) {</span>
                    case NetworkEvent.PROGRESS_TYPE_INITIALIZING:
<span class="nc" id="L280">                        s.setProgress(-1);</span>
<span class="nc" id="L281">                        break;</span>
                    case NetworkEvent.PROGRESS_TYPE_INPUT:
                    case NetworkEvent.PROGRESS_TYPE_OUTPUT:
<span class="nc" id="L284">                        int currentLength = cr.getContentLength();</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                        if (currentLength &gt; 0) {</span>
<span class="nc" id="L286">                            int sentReceived = evt.getSentReceived();</span>
<span class="nc" id="L287">                            float prog = ((float) sentReceived) / ((float) currentLength) * 100f;</span>
<span class="nc" id="L288">                            s.setProgress((int) prog);</span>
<span class="nc" id="L289">                        } else {</span>
<span class="nc" id="L290">                            s.setProgress(-1);</span>
                        }
                }
<span class="nc" id="L293">            }</span>
        };
<span class="nc" id="L295">        cr.addResponseListener(new ActionListener&lt;NetworkEvent&gt;() {</span>
            @Override
            public void actionPerformed(NetworkEvent evt) {
<span class="nc" id="L298">                NetworkManager.getInstance().removeErrorListener(errorListener);</span>
<span class="nc" id="L299">                NetworkManager.getInstance().removeProgressListener(progListener[0]);</span>
<span class="nc" id="L300">                s.clear();</span>
<span class="nc" id="L301">                int rc = cr.getResponseCode();</span>
<span class="nc bnc" id="L302" title="All 8 branches missed.">                if (onSuccess != null &amp;&amp; (rc == 200 || rc == 201 || rc == 202)) {</span>
<span class="nc" id="L303">                    onSuccess.onSucess(evt);</span>
                }
<span class="nc" id="L305">            }</span>
        });
<span class="nc" id="L307">        NetworkManager.getInstance().addProgressListener(progListener[0]);</span>
<span class="nc" id="L308">    }</span>

    /**
     * Gets the default UIID to be used for the style of the {@code ToastBar} component.
     * By default this is &quot;ToastBarComponent&quot;.
     *
     * @return the defaultUIID
     */
    public String getDefaultUIID() {
<span class="nc" id="L317">        return defaultUIID;</span>
    }

    /**
     * Sets the defaults UIID to be used for the style of the {@code ToastBar} component.  By default
     * this is &quot;ToastBarComponent&quot;
     *
     * @param defaultUIID the defaultUIID to set
     */
    public void setDefaultUIID(String defaultUIID) {
<span class="nc" id="L327">        this.defaultUIID = defaultUIID;</span>
<span class="nc" id="L328">    }</span>

    /**
     * Gets the default UIID to be used for the style of the {@code ToastBar} text.  By default
     * this is &quot;ToastBarMessage&quot;
     *
     * @return the defaultMessageUIID
     */
    public String getDefaultMessageUIID() {
<span class="nc" id="L337">        return defaultMessageUIID;</span>
    }

    /**
     * Sets the default UIID to be used for the style of the {@code ToastBar} text.  By default this is
     * &quot;ToastBarMessage&quot;
     *
     * @param defaultMessageUIID the defaultMessageUIID to set
     */
    public void setDefaultMessageUIID(String defaultMessageUIID) {
<span class="nc" id="L347">        this.defaultMessageUIID = defaultMessageUIID;</span>
<span class="nc" id="L348">    }</span>

    /**
     * By default the ToastBar uses the LayeredPane.  However, it may be better in many
     * cases to use the FormLayerd pane.  This allows you to toggle whether to use
     * the FormLayeredPane.
     *
     * &lt;p&gt;Key use-case is for displaying the ToastBar over a Sheet, which is on the FormLayeredPane.
     * If you don't set this to true, then the ToastBar will be displayed behind the Sheet.&lt;/p&gt;
     *
     * @param useFormLayeredPane True to use the form layered pane to display the toastbar.
     * @return Self for chaining.
     * @since 8.0
     */
    public ToastBar useFormLayeredPane(boolean useFormLayeredPane) {
<span class="nc bnc" id="L363" title="All 2 branches missed.">        if (useFormLayeredPane != this.useFormLayeredPane) {</span>
<span class="nc" id="L364">            ToastBarComponent c = getToastBarComponent(false);</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L366">                c.remove();</span>
<span class="nc" id="L367">                getLayeredPane().remove();</span>
            }

<span class="nc" id="L370">            this.useFormLayeredPane = useFormLayeredPane;</span>

        }
<span class="nc" id="L373">        return this;</span>
    }

    /**
     * Gets the position of the toast bar on the screen.  Either {@link Component#TOP} or {@link Component#BOTTOM}.
     *
     * @return the position
     */
    public int getPosition() {
<span class="nc" id="L382">        return position;</span>
    }

    /**
     * Sets the position of the toast bar on the screen.
     *
     * @param position the position to set Should be one of {@link Component#TOP} and {@link Component#BOTTOM}
     */
    public void setPosition(int position) {
<span class="nc" id="L391">        this.position = position;</span>
<span class="nc" id="L392">    }</span>

    /**
     * Updates the ToastBar UI component with the settings of the current status.
     */
    private void updateStatus() {
<span class="nc" id="L398">        final ToastBarComponent c = getToastBarComponent();</span>
<span class="nc" id="L399">        moveLayerToFront();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (c != null) {</span>

            try {
<span class="nc bnc" id="L403" title="All 2 branches missed.">                if (updatingStatus) {</span>
<span class="nc" id="L404">                    pendingUpdateStatus = true;</span>
<span class="nc" id="L405">                    return;</span>
                }

<span class="nc" id="L408">                updatingStatus = true;</span>
<span class="nc bnc" id="L409" title="All 4 branches missed.">                if (c.currentlyShowing != null &amp;&amp; !statuses.contains(c.currentlyShowing)) {</span>
<span class="nc" id="L410">                    c.currentlyShowing = null;</span>
                }
<span class="nc bnc" id="L412" title="All 4 branches missed.">                if (c.currentlyShowing == null || statuses.isEmpty()) {</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">                    if (!statuses.isEmpty()) {</span>
<span class="nc" id="L414">                        c.currentlyShowing = statuses.get(statuses.size() - 1);</span>
                    } else {
<span class="nc" id="L416">                        setVisible(false);</span>
<span class="nc" id="L417">                        return;</span>
                    }

                }
<span class="nc" id="L421">                Status s = c.currentlyShowing;</span>

<span class="nc bnc" id="L423" title="All 2 branches missed.">                Label l = new Label(s.getMessage() != null ? s.getMessage() : &quot;&quot;, defaultMessageUIID);</span>

<span class="nc" id="L425">                c.leadButton.getListeners().clear();</span>
<span class="nc" id="L426">                c.leadButton.addActionListener(s.getListener());</span>
<span class="nc" id="L427">                c.leadButton.addActionListener(new ActionListener() {</span>
                    @Override
                    public void actionPerformed(ActionEvent evt) {
<span class="nc bnc" id="L430" title="All 4 branches missed.">                        if (c.currentlyShowing != null &amp;&amp; !c.currentlyShowing.showProgressIndicator) {</span>
<span class="nc" id="L431">                            c.currentlyShowing.clear();</span>
<span class="nc" id="L432">                            evt.consume();</span>
                        }
<span class="nc" id="L434">                        ToastBar.this.setVisible(false);</span>
<span class="nc" id="L435">                    }</span>
                });

<span class="nc" id="L438">                c.progressLabel.setVisible(s.isShowProgressIndicator());</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">                if (c.progressLabel.isVisible()) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                    if (!c.contains(c.progressLabel)) {</span>
<span class="nc" id="L441">                        c.addComponent(BorderLayout.EAST, c.progressLabel);</span>
                    }
<span class="nc" id="L443">                    Image anim = c.progressLabel.getAnimation();</span>
<span class="nc bnc" id="L444" title="All 4 branches missed.">                    if (anim != null &amp;&amp; anim.getWidth() &gt; 0) {</span>
<span class="nc" id="L445">                        c.progressLabel.setWidth(anim.getWidth());</span>
                    }
<span class="nc bnc" id="L447" title="All 4 branches missed.">                    if (anim != null &amp;&amp; anim.getHeight() &gt; 0) {</span>
<span class="nc" id="L448">                        c.progressLabel.setHeight(anim.getHeight());</span>
                    }
<span class="nc" id="L450">                } else {</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">                    if (c.contains(c.progressLabel)) {</span>
<span class="nc" id="L452">                        c.removeComponent(c.progressLabel);</span>
                    }
                }
<span class="nc bnc" id="L455" title="All 2 branches missed.">                c.progressBar.setVisible(s.getProgress() &gt;= -1);</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">                if (s.getProgress() &gt;= -1) {</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                    if (!c.contains(c.progressBar)) {</span>
<span class="nc" id="L458">                        c.addComponent(BorderLayout.SOUTH, c.progressBar);</span>
                    }
<span class="nc bnc" id="L460" title="All 2 branches missed.">                    if (s.getProgress() &lt; 0) {</span>
<span class="nc" id="L461">                        c.progressBar.setInfinite(true);</span>
                    } else {
<span class="nc" id="L463">                        c.progressBar.setInfinite(false);</span>
<span class="nc" id="L464">                        c.progressBar.setProgress(s.getProgress());</span>
                    }
                } else {
<span class="nc" id="L467">                    c.removeComponent(c.progressBar);</span>
                }
<span class="nc bnc" id="L469" title="All 2 branches missed.">                c.icon.setVisible(s.getIcon() != null);</span>
<span class="nc bnc" id="L470" title="All 4 branches missed.">                if (s.getIcon() != null &amp;&amp; c.icon.getIcon() != s.getIcon()) {</span>
<span class="nc" id="L471">                    c.icon.setIcon(s.getIcon());</span>
                }
<span class="nc bnc" id="L473" title="All 4 branches missed.">                if (s.getIcon() == null &amp;&amp; c.contains(c.icon)) {</span>
<span class="nc" id="L474">                    c.removeComponent(c.icon);</span>
<span class="nc bnc" id="L475" title="All 4 branches missed.">                } else if (s.getIcon() != null &amp;&amp; !c.contains(c.icon)) {</span>

<span class="nc" id="L477">                    c.addComponent(BorderLayout.WEST, c.icon);</span>
                }
<span class="nc" id="L479">                String oldText = c.label.getText();</span>

<span class="nc bnc" id="L481" title="All 2 branches missed.">                if (!oldText.equals(l.getText())) {</span>


<span class="nc bnc" id="L484" title="All 2 branches missed.">                    if (s.getUiid() != null) {</span>
<span class="nc" id="L485">                        c.setUIID(s.getUiid());</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">                    } else if (defaultUIID != null) {</span>
<span class="nc" id="L487">                        c.setUIID(defaultUIID);</span>
                    }

<span class="nc bnc" id="L490" title="All 2 branches missed.">                    if (c.isVisible()) {</span>
<span class="nc" id="L491">                        TextArea newLabel = new TextArea();</span>
<span class="nc" id="L492">                        newLabel.setUIID(defaultMessageUIID);</span>
                        //newLabel.setColumns(l.getText().length()+1);
                        //newLabel.setRows(l.getText().length()+1);
<span class="nc" id="L495">                        newLabel.setFocusable(false);</span>
<span class="nc" id="L496">                        newLabel.setEditable(false);</span>
<span class="nc" id="L497">                        newLabel.setVerticalAlignment(Component.CENTER);</span>

                        //newLabel.getAllStyles().setFgColor(0xffffff);
<span class="nc bnc" id="L500" title="All 2 branches missed.">                        if (s.getMessageUIID() != null) {</span>
<span class="nc" id="L501">                            newLabel.setUIID(s.getMessageUIID());</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">                        } else if (defaultMessageUIID != null) {</span>
<span class="nc" id="L503">                            newLabel.setUIID(defaultMessageUIID);</span>
                        } else {
<span class="nc" id="L505">                            newLabel.setUIID(c.label.getUIID());</span>
                        }
<span class="nc bnc" id="L507" title="All 2 branches missed.">                        if (s.getUiid() != null) {</span>
<span class="nc" id="L508">                            c.setUIID(s.getUiid());</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">                        } else if (defaultUIID != null) {</span>
<span class="nc" id="L510">                            c.setUIID(defaultUIID);</span>
                        }
<span class="nc" id="L512">                        newLabel.setWidth(c.label.getWidth());</span>

<span class="nc" id="L514">                        newLabel.setText(l.getText());</span>

<span class="nc" id="L516">                        Dimension oldTextAreaSize = UIManager.getInstance().getLookAndFeel().getTextAreaSize(c.label, true);</span>
<span class="nc" id="L517">                        Dimension newTexAreaSize = UIManager.getInstance().getLookAndFeel().getTextAreaSize(newLabel, true);</span>

                        // this can happen in an edge case where animateHierarchyAndWait and replaceAndWait
                        // are stuck in blocking mode between them and the label just got discarded see:
                        // https://stackoverflow.com/questions/46172993/codename-one-toastbar-nullpointerexception
<span class="nc bnc" id="L522" title="All 2 branches missed.">                        if (c.label.getParent() != null) {</span>
<span class="nc" id="L523">                            c.label.getParent().replaceAndWait(c.label, newLabel, CommonTransitions.createCover(CommonTransitions.SLIDE_VERTICAL, true, 300));</span>
<span class="nc" id="L524">                            c.label = newLabel;</span>

<span class="nc bnc" id="L526" title="All 2 branches missed.">                            if (oldTextAreaSize.getHeight() != newTexAreaSize.getHeight()) {</span>

<span class="nc" id="L528">                                c.label.setPreferredH(newTexAreaSize.getHeight());</span>
<span class="nc" id="L529">                                c.getParent().animateHierarchyAndWait(300);</span>
                            }
                        }

<span class="nc" id="L533">                    } else {</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">                        if (s.getMessageUIID() != null) {</span>
<span class="nc" id="L535">                            c.label.setUIID(s.getMessageUIID());</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">                        } else if (defaultMessageUIID != null) {</span>
<span class="nc" id="L537">                            c.label.setUIID(defaultMessageUIID);</span>
                        }
<span class="nc bnc" id="L539" title="All 2 branches missed.">                        if (s.getUiid() != null) {</span>
<span class="nc" id="L540">                            c.setUIID(s.getUiid());</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">                        } else if (defaultUIID != null) {</span>
<span class="nc" id="L542">                            c.setUIID(defaultUIID);</span>
                        }
<span class="nc" id="L544">                        c.label.setText(l.getText());</span>
                        //c.label.setColumns(l.getText().length()+1);
                        //c.label.setRows(l.getText().length()+1);
<span class="nc" id="L547">                        c.label.setPreferredW(c.getWidth());</span>
<span class="nc" id="L548">                        c.revalidate();</span>
                    }
                } else {
<span class="nc" id="L551">                    c.revalidate();</span>
                }
            } finally {
<span class="nc" id="L554">                updatingStatus = false;</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">                if (pendingUpdateStatus) {</span>
<span class="nc" id="L556">                    pendingUpdateStatus = false;</span>
<span class="nc" id="L557">                    Display.getInstance().callSerially(new Runnable() {</span>
                        public void run() {
<span class="nc" id="L559">                            updateStatus();</span>
<span class="nc" id="L560">                        }</span>
                    });
                }
            }
        }
<span class="nc" id="L565">    }</span>

    /**
     * Creates a new Status.
     *
     * @return
     */
    public Status createStatus() {
<span class="nc" id="L573">        Status s = new Status();</span>
<span class="nc" id="L574">        statuses.add(s);</span>
<span class="nc" id="L575">        return s;</span>
    }

    private void removeStatus(Status status) {
<span class="nc bnc" id="L579" title="All 2 branches missed.">        if (status.timer != null) {</span>
<span class="nc" id="L580">            status.timer.cancel();</span>
<span class="nc" id="L581">            status.timer = null;</span>
        }
<span class="nc" id="L583">        statuses.remove(status);</span>
<span class="nc" id="L584">        updateStatus();</span>
<span class="nc" id="L585">    }</span>

    private Container getLayeredPane() {
<span class="nc" id="L588">        Form f = Display.getInstance().getCurrent();</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">        if (f == null) {</span>
<span class="nc" id="L590">            throw new IllegalStateException(&quot;Cannot get layered pane when form is null&quot;);</span>
        }
<span class="nc bnc" id="L592" title="All 2 branches missed.">        if (useFormLayeredPane) {</span>
<span class="nc" id="L593">            return f.getFormLayeredPane(this.getClass(), true);</span>
        } else {
<span class="nc" id="L595">            return f.getLayeredPane(this.getClass(), true);</span>
        }
    }

    private void moveLayerToFront() {
<span class="nc" id="L600">        Form f = Display.getInstance().getCurrent();</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">        if (f == null) return;</span>
<span class="nc" id="L602">        final Container layered = getLayeredPane();</span>
<span class="nc" id="L603">        final Container parent = layered.getParent();</span>
<span class="nc bnc" id="L604" title="All 2 branches missed.">        if (parent == null) {</span>
<span class="nc" id="L605">            return;</span>
        }
<span class="nc bnc" id="L607" title="All 2 branches missed.">        if (parent.getComponentIndex(layered) != parent.getComponentCount() - 1) {</span>
<span class="nc" id="L608">            f.getAnimationManager().flushAnimation(new Runnable() {</span>
                public void run() {
<span class="nc" id="L610">                    parent.removeComponent(layered);</span>
<span class="nc" id="L611">                    parent.addComponent(layered);</span>
<span class="nc" id="L612">                    parent.revalidate();</span>
<span class="nc" id="L613">                }</span>
            });


        }
<span class="nc" id="L618">    }</span>

    private ToastBarComponent getToastBarComponent() {
<span class="nc" id="L621">        return getToastBarComponent(true);</span>
    }

    private ToastBarComponent getToastBarComponent(boolean create) {
<span class="nc" id="L625">        Form f = Display.getInstance().getCurrent();</span>
<span class="nc bnc" id="L626" title="All 4 branches missed.">        if (f != null &amp;&amp; !(f instanceof Dialog)) {</span>
<span class="nc" id="L627">            ToastBarComponent c = (ToastBarComponent) f.getClientProperty(&quot;ToastBarComponent&quot;);</span>
<span class="nc bnc" id="L628" title="All 4 branches missed.">            if (c == null &amp;&amp; !create) {</span>
<span class="nc" id="L629">                return null;</span>
            }
<span class="nc bnc" id="L631" title="All 4 branches missed.">            if (c == null || c.getParent() == null) {</span>
<span class="nc" id="L632">                c = new ToastBarComponent();</span>
<span class="nc" id="L633">                c.hidden = true;</span>
<span class="nc" id="L634">                f.putClientProperty(&quot;ToastBarComponent&quot;, c);</span>
<span class="nc" id="L635">                Container layered = getLayeredPane();</span>
<span class="nc" id="L636">                layered.setLayout(new BorderLayout());</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">                layered.addComponent(position == Component.TOP ? BorderLayout.NORTH : BorderLayout.SOUTH, c);</span>
<span class="nc" id="L638">                updateStatus();</span>
            }
<span class="nc" id="L640">            Rectangle safeArea = Display.getInstance().getDisplaySafeArea(new Rectangle(0, 0, 0, 0));</span>
            // PMD Fix (CollapsibleIfStatements): Combine nested position checks to simplify the layout adjustments.
<span class="nc bnc" id="L642" title="All 4 branches missed.">            if (position == Component.BOTTOM &amp;&amp; f.getInvisibleAreaUnderVKB() &gt; 0) {</span>
<span class="nc" id="L643">                Style s = c.getAllStyles();</span>
<span class="nc" id="L644">                s.setMarginUnit(Style.UNIT_TYPE_PIXELS);</span>
<span class="nc" id="L645">                s.setMarginBottom(f.getInvisibleAreaUnderVKB());</span>
            }
<span class="nc" id="L647">            int safeBottomMargin = Display.getInstance().getDisplayHeight()</span>
<span class="nc" id="L648">                    - safeArea.getY()</span>
<span class="nc" id="L649">                    - safeArea.getHeight();</span>
<span class="nc bnc" id="L650" title="All 4 branches missed.">            if (position == Component.BOTTOM &amp;&amp; safeBottomMargin &gt; 0) {</span>
<span class="nc" id="L651">                Style s = c.getAllStyles();</span>
<span class="nc" id="L652">                s.setPaddingUnit(Style.UNIT_TYPE_PIXELS);</span>
<span class="nc" id="L653">                s.setPaddingBottom(safeBottomMargin);</span>
<span class="nc bnc" id="L654" title="All 4 branches missed.">            } else if (position == Component.TOP &amp;&amp; safeArea.getY() &gt; 0) {</span>
<span class="nc" id="L655">                Style s = c.getAllStyles();</span>
<span class="nc" id="L656">                s.setPaddingUnit(Style.UNIT_TYPE_PIXELS);</span>
<span class="nc" id="L657">                s.setPaddingTop(safeArea.getY());</span>
            }

<span class="nc" id="L660">            return c;</span>
        }
<span class="nc" id="L662">        return null;</span>
    }

    /**
     * Shows or hides the {@code ToastBar}.
     *
     * @param visible
     */
    public void setVisible(boolean visible) {
<span class="nc" id="L671">        final ToastBarComponent c = getToastBarComponent();</span>
<span class="nc bnc" id="L672" title="All 4 branches missed.">        if (c == null || c.isVisible() == visible) {</span>
<span class="nc" id="L673">            return;</span>
        }
<span class="nc bnc" id="L675" title="All 2 branches missed.">        if (visible) {</span>
<span class="nc" id="L676">            c.hidden = true;</span>
<span class="nc" id="L677">            c.setVisible(false);</span>
<span class="nc" id="L678">            c.setHeight(0);</span>
<span class="nc" id="L679">            c.setShouldCalcPreferredSize(true);</span>
<span class="nc" id="L680">            Form f = c.getComponentForm();</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">            if (f != null) {</span>
<span class="nc" id="L682">                f.revalidate();</span>
            } else {
<span class="nc" id="L684">                c.getParent().revalidate();</span>
            }
<span class="nc" id="L686">            c.hidden = false;</span>

<span class="nc" id="L688">            c.label.setPreferredH(UIManager.getInstance().getLookAndFeel().getTextAreaSize(c.label, true).getHeight());</span>
<span class="nc" id="L689">            c.setShouldCalcPreferredSize(true);</span>
<span class="nc" id="L690">            $(c).slideUpAndWait(2);</span>
<span class="nc" id="L691">            $(c).slideDownAndWait(800);</span>
<span class="nc" id="L692">            c.setVisible(true);</span>
<span class="nc" id="L693">            updateStatus();</span>

<span class="nc" id="L695">        } else {</span>
<span class="nc" id="L696">            Form f = c.getComponentForm();</span>
<span class="nc bnc" id="L697" title="All 4 branches missed.">            if (Display.getInstance().getCurrent() == f &amp;&amp; !f.getMenuBar().isMenuShowing()) {</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">                if (this.position == Component.BOTTOM) {</span>
<span class="nc" id="L699">                    c.setY(c.getY() + c.getHeight());</span>
                }
<span class="nc" id="L701">                $(c).slideUpAndWait(500);</span>
            } else {
<span class="nc" id="L703">                c.getParent().revalidate();</span>
            }
<span class="nc" id="L705">            c.hidden = true;</span>
<span class="nc" id="L706">            c.setVisible(false);</span>
        }
<span class="nc" id="L708">    }</span>

    /**
     * Represents a single status message.
     */
    public class Status {

        /**
         * The start time of the process this status is tracking.
         */
        private final long startTime;
        /**
         * This UIID that should be used to style the ToastBar text while this
         * message is being displayed.
         */
<span class="nc" id="L723">        private String messageUIID = defaultMessageUIID;</span>
        /**
         * The UIID that should be used to style the ToastBar component while
         * this message is being displayed.
         */
<span class="nc" id="L728">        private String uiid = defaultUIID;</span>
        /**
         * Timer used to &quot;expire&quot; the message after a certain time.
         *
         * @see #setExpires(int)
         */
        private Timer timer;
        /**
         * Timer used to delay the showing of the message.  Useful if you only want
         * to show the message if the task ends up taking a long time.
         *
         * @see #showDelayed(int)
         */
        private Timer showTimer;

        /**
         * The message to be displayed in the {@code ToastBar}.
         */
        private String message;

        /**
         * An action to perform when the ToastBar is tapped {@code ToastBar}.
         */
        private ActionListener listener;

        /**
         * Optional progress for the task.  (Not tested or implemented yet).
         */
<span class="nc" id="L756">        private int progress = -2;</span>

        /**
         * Optional icon to show in the {@code ToastBar}.  (Not tested or implemented yet).
         */
        private Image icon;

        /**
         * Whether this status message should show an infinite progress indicator. (e.g. spinning beachball).
         */
        private boolean showProgressIndicator;

<span class="nc" id="L768">        private Status() {</span>
<span class="nc" id="L769">            startTime = System.currentTimeMillis();</span>
<span class="nc" id="L770">        }</span>

        /**
         * Directs the status to be cleared (if it isn't already cleared() after a given number of milliseconds.
         *
         * @param millis The maximum number of milliseconds that the status message should be displayed for.
         *               Helpful for error messages that only need to be displayed for a few seconds.
         */
        public void setExpires(int millis) {
<span class="nc bnc" id="L779" title="All 4 branches missed.">            if (millis &lt; 0 &amp;&amp; timer != null) {</span>
<span class="nc" id="L780">                timer.cancel();</span>
<span class="nc" id="L781">                timer = null;</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">            } else if (millis &gt; 0) {</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">                if (timer != null) {</span>
<span class="nc" id="L784">                    timer.cancel();</span>
<span class="nc" id="L785">                    timer = null;</span>
                }
<span class="nc" id="L787">                timer = new Timer();</span>
<span class="nc" id="L788">                timer.schedule(new TimerTask() {</span>

                    @Override
                    public void run() {
<span class="nc" id="L792">                        Display.getInstance().callSerially(new Runnable() {</span>
                            public void run() {
<span class="nc" id="L794">                                timer = null;</span>
<span class="nc" id="L795">                                Status.this.clear();</span>
<span class="nc" id="L796">                            }</span>
                        });
<span class="nc" id="L798">                    }</span>

                }, millis);
            }
<span class="nc" id="L802">        }</span>

        /**
         * Shows this status message.  Call this method after making any changes
         * to the status that you want to have displayed.  This will always cause
         * any currently-displayed status to be replaced by this status.
         * &lt;p&gt;If you don't want to show the status immediately, but rather to wait some delay, you can use
         * the {@link #showDelayed(int) } method instead.&lt;/p&gt;
         *
         * @see #showDelayed(int)
         */
        public void show() {
<span class="nc bnc" id="L814" title="All 2 branches missed.">            if (showTimer != null) {</span>
<span class="nc" id="L815">                showTimer.cancel();</span>
<span class="nc" id="L816">                showTimer = null;</span>
            }
<span class="nc" id="L818">            ToastBarComponent c = getToastBarComponent();</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L820">                c.currentlyShowing = this;</span>
<span class="nc" id="L821">                updateStatus();</span>
<span class="nc" id="L822">                setVisible(true);</span>

            }
<span class="nc" id="L825">        }</span>

        /**
         * Schedules this status message to be shown after a specified number of milliseconds,
         * if it hasn't been cleared or shown first.
         * &lt;p&gt;This is handy if you want to show a status for an operation that usually completes very quickly, but could
         * potentially hang.  In such a case you might decide not to display a status message at all unless the operation
         * takes more than 500ms to complete.&lt;/p&gt;
         *
         * &lt;p&gt;If you want to show the status immediately, use the {@link #show() } method instead.&lt;/p&gt;
         *
         * @param millis Number of milliseconds to wait before showing the status.
         */
        public void showDelayed(int millis) {
<span class="nc" id="L839">            showTimer = new Timer();</span>
<span class="nc" id="L840">            showTimer.schedule(new TimerTask() {</span>
                @Override
                public void run() {
<span class="nc" id="L843">                    Display.getInstance().callSerially(new Runnable() {</span>
                        public void run() {
<span class="nc bnc" id="L845" title="All 2 branches missed.">                            if (showTimer != null) {</span>
<span class="nc" id="L846">                                showTimer = null;</span>
<span class="nc" id="L847">                                show();</span>
                            }
<span class="nc" id="L849">                        }</span>
                    });
<span class="nc" id="L851">                }</span>

            }, millis);
<span class="nc" id="L854">        }</span>

        /**
         * Clears this status message. This any pending &quot;showDelayed&quot; requests for this status.
         */
        public void clear() {
<span class="nc bnc" id="L860" title="All 2 branches missed.">            if (showTimer != null) {</span>
<span class="nc" id="L861">                showTimer.cancel();</span>
<span class="nc" id="L862">                showTimer = null;</span>
            }
<span class="nc bnc" id="L864" title="All 2 branches missed.">            if (timer != null) {</span>
<span class="nc" id="L865">                timer.cancel();</span>
<span class="nc" id="L866">                timer = null;</span>
            }
<span class="nc" id="L868">            removeStatus(this);</span>
<span class="nc" id="L869">        }</span>

        /**
         * Returns the text that will be displayed for this status.
         *
         * @return the message
         */
        public String getMessage() {
<span class="nc" id="L877">            return message;</span>
        }

        /**
         * Sets the message that should be displayed in the {@code ToastBar}.
         *
         * @param message
         */
        public void setMessage(String message) {
<span class="nc" id="L886">            this.message = message;</span>

<span class="nc" id="L888">        }</span>

        /**
         * Returns the listener added to perform a particular action.
         *
         * @return the listener
         */
        public ActionListener getListener() {
<span class="nc" id="L896">            return listener;</span>
        }

        /**
         * Sets the action listener needed to perform an action when the bar is tapped {@code ToastBar}.
         *
         * @param listener
         */
        public void setListener(ActionListener listener) {
<span class="nc" id="L905">            this.listener = listener;</span>
<span class="nc" id="L906">        }</span>

        /**
         * Returns the progress of this status.  A value of -1 indicates that the progress
         * bar should not be shown.  Values between 0 and 100 inclusive will be rendered
         * on a progress bar (slider) in the status component.
         *
         * @return the progress
         */
        public int getProgress() {
<span class="nc" id="L916">            return progress;</span>
        }

        /**
         * Sets the progress (-1..100) that should be displayed in the progress bar
         * for this status.  When set to -1 it will act as an infinite progress
         *
         * @param progress
         */
        public void setProgress(int progress) {
<span class="nc" id="L926">            this.progress = progress;</span>
<span class="nc" id="L927">            updateStatus();</span>
<span class="nc" id="L928">        }</span>

        /**
         * Gets the icon (may be null) that is displayed with this status.
         *
         * @return the icon
         */
        public Image getIcon() {
<span class="nc" id="L936">            return icon;</span>
        }

        /**
         * Sets the icon that is to be displayed with this status.  Set this to null to not show an icon.
         *
         * @param icon the icon to set
         */
        public void setIcon(Image icon) {
<span class="nc" id="L945">            this.icon = icon;</span>
<span class="nc" id="L946">        }</span>

        /**
         * @return the showProgressIndicator
         */
        public boolean isShowProgressIndicator() {
<span class="nc" id="L952">            return showProgressIndicator;</span>
        }

        /**
         * Sets whether this status message should include an infinite progress indicator (e.g. spinning beach ball).
         *
         * @param showProgressIndicator the showProgressIndicator to set
         */
        public void setShowProgressIndicator(boolean showProgressIndicator) {
<span class="nc" id="L961">            this.showProgressIndicator = showProgressIndicator;</span>
<span class="nc" id="L962">        }</span>

        /**
         * Gets the UIID to use for styling the text of this status message.
         *
         * @return the messageUIID
         */
        public String getMessageUIID() {
<span class="nc" id="L970">            return messageUIID;</span>
        }

        /**
         * Sets the UIID to use for styling the text of this status message.
         *
         * @param messageUIID the messageUIID to set
         */
        public void setMessageUIID(String messageUIID) {
<span class="nc" id="L979">            this.messageUIID = messageUIID;</span>
<span class="nc" id="L980">        }</span>

        /**
         * Gets the UIID that should be used for styling the status component while
         * this status is displayed.
         *
         * @return the uiid
         */
        public String getUiid() {
<span class="nc" id="L989">            return uiid;</span>
        }

        /**
         * Sets the UIID that should be used for styling the status component while
         * this status is displayed.
         *
         * @param uiid the uiid to set
         */
        public void setUiid(String uiid) {
<span class="nc" id="L999">            this.uiid = uiid;</span>
<span class="nc" id="L1000">        }</span>

    }

    /**
     * The actual component for the {@code ToastBar}.  This is added to the layered pane of
     * the top-level form.
     */
    private class ToastBarComponent extends Container {
<span class="nc" id="L1009">        boolean hidden = true;</span>
<span class="nc" id="L1010">        Button leadButton = new Button();</span>
        private TextArea label;
        private final InfiniteProgress progressLabel;
        private final Slider progressBar;
        private final Label icon;
        private Status currentlyShowing;

<span class="nc" id="L1017">        public ToastBarComponent() {</span>
<span class="nc" id="L1018">            this.getAllStyles().setBgColor(0x0);</span>
<span class="nc" id="L1019">            this.getAllStyles().setBackgroundType(Style.BACKGROUND_NONE);</span>
<span class="nc" id="L1020">            this.getAllStyles().setBgTransparency(128);</span>
<span class="nc" id="L1021">            setVisible(false);</span>
<span class="nc" id="L1022">            label = new TextArea();</span>
<span class="nc" id="L1023">            label.setUIID(defaultMessageUIID);</span>
<span class="nc" id="L1024">            label.setEditable(false);</span>
<span class="nc" id="L1025">            label.setFocusable(false);</span>
<span class="nc" id="L1026">            label.setVerticalAlignment(CENTER);</span>

<span class="nc" id="L1028">            progressLabel = new InfiniteProgress();</span>

<span class="nc" id="L1030">            progressLabel.setAngleIncrease(4);</span>
<span class="nc" id="L1031">            progressLabel.setVisible(false);</span>
<span class="nc" id="L1032">            icon = new Label();</span>
<span class="nc" id="L1033">            icon.setVisible(false);</span>
<span class="nc" id="L1034">            progressBar = new Slider();</span>
<span class="nc" id="L1035">            progressBar.setVisible(false);</span>

<span class="nc" id="L1037">            leadButton.addActionListener(new ActionListener() {</span>
                public void actionPerformed(ActionEvent evt) {
<span class="nc bnc" id="L1039" title="All 4 branches missed.">                    if (currentlyShowing != null &amp;&amp; !currentlyShowing.showProgressIndicator) {</span>
<span class="nc" id="L1040">                        currentlyShowing.clear();</span>
                    }
<span class="nc" id="L1042">                    ToastBar.this.setVisible(false);</span>
<span class="nc" id="L1043">                }</span>
            });
<span class="nc" id="L1045">            leadButton.setVisible(false);</span>

<span class="nc" id="L1047">            this.setLeadComponent(leadButton);</span>

<span class="nc" id="L1049">            setLayout(new BorderLayout());</span>
<span class="nc" id="L1050">            addComponent(BorderLayout.WEST, icon);</span>
<span class="nc" id="L1051">            addComponent(BorderLayout.CENTER, label);</span>
<span class="nc" id="L1052">            addComponent(BorderLayout.SOUTH, progressBar);</span>
<span class="nc" id="L1053">            addComponent(BorderLayout.EAST, progressLabel);</span>

<span class="nc" id="L1055">            progressBar.setVisible(false);</span>
<span class="nc" id="L1056">        }</span>

        @Override
        protected Dimension calcPreferredSize() {
<span class="nc bnc" id="L1060" title="All 2 branches missed.">            if (hidden) {</span>
<span class="nc" id="L1061">                return new Dimension(Display.getInstance().getDisplayWidth(),</span>
                        0
                );
            } else {
<span class="nc" id="L1065">                return super.calcPreferredSize();</span>
                /*
                return new Dimension(Display.getInstance().getDisplayWidth(),
                        Display.getInstance().convertToPixels(10, false)
                );*/
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>