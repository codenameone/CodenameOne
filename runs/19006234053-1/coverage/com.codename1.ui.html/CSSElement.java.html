<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CSSElement.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">codenameone-core-unittests</a> &gt; <a href="index.source.html" class="el_package">com.codename1.ui.html</a> &gt; <span class="el_source">CSSElement.java</span></div><h1>CSSElement.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2008, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores
 * CA 94065 USA or visit www.oracle.com if you need additional information or
 * have any questions.
 */
package com.codename1.ui.html;

import com.codename1.ui.Component;
import com.codename1.ui.Font;
import com.codename1.ui.plaf.Style;

import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Vector;

/**
 * The CSSElement class defines a single CSS element with its attributes and children.
 * It extends Element and adds to it certain CSS-specific methods.
 * Each CSSElement object is in fact a CSS selector.
 *
 * @author Ofir Leitner
 */
class CSSElement extends HTMLElement {

    /**
     * A constant representing both the attribute value of 'font-variant' and the font name that should be given to small-caps fonts
     * Since J2ME doesn't support small-caps fonts, when a small-caps font varinat is requested
     * the font-family is changed to &quot;smallcaps&quot; which should be loaded to HTMLComponent and the theme as a bitmap font
     * If no smallcaps font is found at all, then the family stays the same, but if even only one is found - the best match will be used.
     */
    final static String SMALL_CAPS_STRING = &quot;small-caps&quot;;
    // Background repeat strings and their corresponding values
<span class="nc" id="L51">    static final String[] BG_REPEAT_STRINGS = {&quot;repeat&quot;, &quot;repeat-x&quot;, &quot;repeat-y&quot;, &quot;no-repeat&quot;};</span>
    //
    // Font strings and values constants
    //
    static final int FONT_SIZE_SMALLER = -3;
    static final int FONT_SIZE_LARGER = -2;
    // Constants defining the approximate sizes of a small/medium/large font (This can be tweaked per platform)
    static final int FONT_SIZE_SMALL = 12;
    static final int FONT_SIZE_MEDIUM = 15;
    static final int FONT_SIZE_LARGE = 19;
    /**
     * Since the other tags are 0 based the CSS tags should start at this point
     */
    static final int CSS_STYLE_ID_OFFSET = 500;
    // CSS Attributes
    static final int CSS_BACKGROUND_COLOR = CSS_STYLE_ID_OFFSET;
    static final int CSS_BACKGROUND_IMAGE = CSS_STYLE_ID_OFFSET + 1;
    static final int CSS_BACKGROUND_REPEAT = CSS_STYLE_ID_OFFSET + 2;
    static final int CSS_BACKGROUND_ATTACHMENT = CSS_STYLE_ID_OFFSET + 3;
    static final int CSS_BACKGROUND_POSITION_X = CSS_STYLE_ID_OFFSET + 4;
    static final int CSS_BACKGROUND_POSITION_Y = CSS_STYLE_ID_OFFSET + 5;
    static final int CSS_BORDER_TOP_WIDTH = CSS_STYLE_ID_OFFSET + 6;
    static final int CSS_BORDER_LEFT_WIDTH = CSS_STYLE_ID_OFFSET + 7;
    static final int CSS_BORDER_BOTTOM_WIDTH = CSS_STYLE_ID_OFFSET + 8;
    static final int CSS_BORDER_RIGHT_WIDTH = CSS_STYLE_ID_OFFSET + 9;
    static final int CSS_BORDER_TOP_STYLE = CSS_STYLE_ID_OFFSET + 10;
    static final int CSS_BORDER_LEFT_STYLE = CSS_STYLE_ID_OFFSET + 11;
    static final int CSS_BORDER_BOTTOM_STYLE = CSS_STYLE_ID_OFFSET + 12;
    static final int CSS_BORDER_RIGHT_STYLE = CSS_STYLE_ID_OFFSET + 13;
    static final int CSS_BORDER_TOP_COLOR = CSS_STYLE_ID_OFFSET + 14;
    static final int CSS_BORDER_LEFT_COLOR = CSS_STYLE_ID_OFFSET + 15;
    static final int CSS_BORDER_BOTTOM_COLOR = CSS_STYLE_ID_OFFSET + 16;
    static final int CSS_BORDER_RIGHT_COLOR = CSS_STYLE_ID_OFFSET + 17;
    static final int CSS_CLEAR = CSS_STYLE_ID_OFFSET + 18;
    static final int CSS_COLOR = CSS_STYLE_ID_OFFSET + 19;
    static final int CSS_VERTICAL_ALIGN = CSS_STYLE_ID_OFFSET + 20;
    static final int CSS_DISPLAY = CSS_STYLE_ID_OFFSET + 21;
    static final int CSS_FLOAT = CSS_STYLE_ID_OFFSET + 22;
    static final int CSS_FONT_FAMILY = CSS_STYLE_ID_OFFSET + 23;
    static final int CSS_FONT_SIZE = CSS_STYLE_ID_OFFSET + 24;
    static final int CSS_FONT_STYLE = CSS_STYLE_ID_OFFSET + 25;
    static final int CSS_FONT_WEIGHT = CSS_STYLE_ID_OFFSET + 26;
    static final int CSS_FONT_VARIANT = CSS_STYLE_ID_OFFSET + 27;
    static final int CSS_HEIGHT = CSS_STYLE_ID_OFFSET + 28;
    static final int CSS_WIDTH = CSS_STYLE_ID_OFFSET + 29;
    static final int CSS_VISIBILITY = CSS_STYLE_ID_OFFSET + 30;
    static final int CSS_WHITE_SPACE = CSS_STYLE_ID_OFFSET + 31;
    static final int CSS_LIST_STYLE_IMAGE = CSS_STYLE_ID_OFFSET + 32;
    static final int CSS_LIST_STYLE_POSITION = CSS_STYLE_ID_OFFSET + 33;
    static final int CSS_LIST_STYLE_TYPE = CSS_STYLE_ID_OFFSET + 34;
    static final int CSS_MARGIN_TOP = CSS_STYLE_ID_OFFSET + 35;
    static final int CSS_MARGIN_LEFT = CSS_STYLE_ID_OFFSET + 36;
    static final int CSS_MARGIN_BOTTOM = CSS_STYLE_ID_OFFSET + 37;
    static final int CSS_MARGIN_RIGHT = CSS_STYLE_ID_OFFSET + 38;
    static final int CSS_PADDING_TOP = CSS_STYLE_ID_OFFSET + 39;
    static final int CSS_PADDING_LEFT = CSS_STYLE_ID_OFFSET + 40;
    static final int CSS_PADDING_BOTTOM = CSS_STYLE_ID_OFFSET + 41;
    static final int CSS_PADDING_RIGHT = CSS_STYLE_ID_OFFSET + 42;
    static final int CSS_TEXT_ALIGN = CSS_STYLE_ID_OFFSET + 43;
    static final int CSS_TEXT_DECORATION = CSS_STYLE_ID_OFFSET + 44;
    static final int CSS_TEXT_INDENT = CSS_STYLE_ID_OFFSET + 45;
    static final int CSS_TEXT_TRANSFORM = CSS_STYLE_ID_OFFSET + 46;
    static final int CSS_WAP_ACCESSKEY = CSS_STYLE_ID_OFFSET + 47;
    static final int CSS_WAP_INPUT_FORMAT = CSS_STYLE_ID_OFFSET + 48;
    static final int CSS_WAP_INPUT_REQUIRED = CSS_STYLE_ID_OFFSET + 49;
    static final int CSS_PAGEURL = CSS_STYLE_ID_OFFSET + 50; // This attribute is not a CSS attribute, but rather for internal CodenameOne usage, to identify the stylesheet's base url
    static final int CSS_BORDER_COLLAPSE = CSS_STYLE_ID_OFFSET + 51;
    static final int CSS_EMPTY_CELLS = CSS_STYLE_ID_OFFSET + 52;
    static final int CSS_BORDER_SPACING = CSS_STYLE_ID_OFFSET + 53;
    static final int CSS_CAPTION_SIDE = CSS_STYLE_ID_OFFSET + 54;
    static final int CSS_WORD_SPACING = CSS_STYLE_ID_OFFSET + 55;
    static final int CSS_LINE_HEIGHT = CSS_STYLE_ID_OFFSET + 56;
    static final int CSS_MIN_WIDTH = CSS_STYLE_ID_OFFSET + 57;
    static final int CSS_MAX_WIDTH = CSS_STYLE_ID_OFFSET + 58;
    static final int CSS_MIN_HEIGHT = CSS_STYLE_ID_OFFSET + 59;
    static final int CSS_MAX_HEIGHT = CSS_STYLE_ID_OFFSET + 60;
    static final int CSS_QUOTES = CSS_STYLE_ID_OFFSET + 61;
    static final int CSS_OUTLINE_WIDTH = CSS_STYLE_ID_OFFSET + 62;
    static final int CSS_OUTLINE_STYLE = CSS_STYLE_ID_OFFSET + 63;
    static final int CSS_OUTLINE_COLOR = CSS_STYLE_ID_OFFSET + 64;
    static final int CSS_CONTENT = CSS_STYLE_ID_OFFSET + 65;
    static final int CSS_COUNTER_RESET = CSS_STYLE_ID_OFFSET + 66;
    static final int CSS_COUNTER_INCREMENT = CSS_STYLE_ID_OFFSET + 67;
    static final int CSS_DIRECTION = CSS_STYLE_ID_OFFSET + 68;
    private static final int LAST_CSS_PROPERTY_INDEX = (HTMLComponent.PROCESS_HTML_MP1_ONLY ? CSS_PAGEURL : CSS_DIRECTION) - CSS_STYLE_ID_OFFSET;
    /**
     * The types of the attribute
     */
<span class="nc" id="L139">    static final int[] CSS_ATTRIBUTE_TYPES = {</span>
            TYPE_COLOR, // CSS_BACKGROUND_COLOR
            TYPE_CSS_URL, //CSS_BACKGROUND_IMAGE
            TYPE_NMTOKENS, //CSS_BACKGROUND_REPEAT
            TYPE_NMTOKENS, //CSS_BACKGROUND_ATTACHMENT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_BACKGROUND_POSITION_X
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_BACKGROUND_POSITION_Y
            TYPE_CSS_LENGTH, //CSS_BORDER_TOP_WIDTH
            TYPE_CSS_LENGTH, //CSS_BORDER_RIGHT_WIDTH
            TYPE_CSS_LENGTH, //CSS_BORDER_BOTTOM_WIDTH
            TYPE_CSS_LENGTH, //CSS_BORDER_LEFT_WIDTH
            TYPE_NMTOKENS, //CSS_BORDER_TOP_STYLE
            TYPE_NMTOKENS, //CSS_BORDER_RIGHT_STYLE
            TYPE_NMTOKENS, //CSS_BORDER_BOTTOM_STYLE
            TYPE_NMTOKENS, //CSS_BORDER_LEFT_STYLE
            TYPE_COLOR, //CSS_BORDER_TOP_COLOR
            TYPE_COLOR, // CSS_BORDER_RIGHT_COLOR
            TYPE_COLOR, // CSS_BORDER_BOTTOM_COLOR
            TYPE_COLOR, // CSS_BORDER_LEFT_COLOR
            TYPE_NMTOKENS, //CSS_CLEAR
            TYPE_COLOR, // CSS_COLOR
            TYPE_NMTOKENS, //CSS_VERTICAL_ALIGN
            TYPE_NMTOKENS, //CSS_DISPLAY
            TYPE_NMTOKENS, //CSS_FLOAT
            TYPE_NMTOKENS, //CSS_FONT_FAMILY
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_FONT_SIZE
            TYPE_NMTOKENS, //CSS_FONT_STYLE
            TYPE_NMTOKENS, //CSS_FONT_WEIGHT
            TYPE_NMTOKENS, //CSS_FONT_VARIANT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_HEIGHT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_WIDTH
            TYPE_NMTOKENS, // CSS_VISIBILITY
            TYPE_NMTOKENS, //CSS_WHITE_SPACE
            TYPE_CSS_URL, //CSS_LIST_STYLE_IMAGE
            TYPE_NMTOKENS, //CSS_LIST_STYLE_POSITION
            TYPE_NMTOKENS, //CSS_LIST_STYLE_TYPE
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_TOP
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_RIGHT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_BOTTOM
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_LEFT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_TOP
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_RIGHT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_BOTTOM
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_LEFT
            TYPE_ALIGN, //CSS_TEXT_ALIGN
            TYPE_NMTOKENS, //CSS_TEXT_DECORATION
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_TEXT_INDENT
            TYPE_NMTOKENS, //CSS_TEXT_TRANSFORM
            TYPE_NMTOKENS, // CSS_WAP_ACCESSKEY
            TYPE_NMTOKENS, // CSS_WAP_INPUT_FORMAT
            TYPE_BOOLEAN, // CSS_WAP_INPUT_REQUIRED
            TYPE_NMTOKENS, // CSS_PAGE_URL (internal usage)
            TYPE_NMTOKENS, // CSS_BORDER_COLLAPSE
            TYPE_NMTOKENS, // CSS_EMPTY_CELLS
            TYPE_NMTOKENS,// CSS_BORDER_SPACING
            TYPE_NMTOKENS,// CSS_CAPTION_SIDE
            TYPE_CSS_LENGTH_OR_PERCENTAGE, // CSS_WORD_SPACING
            TYPE_CSS_LENGTH_OR_PERCENTAGE_OR_MULTIPLIER, //CSS_LINE_HEIGHT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MIN_WIDTH
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MAX_WIDTH
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MIN_HEIGHT
            TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MAX_HEIGHT
            TYPE_NMTOKENS, //CSS_QUOTES
            TYPE_CSS_LENGTH, //CSS_OUTLINE_WIDTH
            TYPE_NMTOKENS, //CSS_OUTLINE_STYLE
            TYPE_COLOR, //CSS_OUTLINE_COLOR
            TYPE_NMTOKENS, //CSS_CONTENT
            TYPE_NMTOKENS, //CSS_COUNTER_RESET
            TYPE_NMTOKENS, //CSS_COUNTER_INCREMENT
            TYPE_NMTOKENS, //CSS_DIRECTION
    };
    /**
     * This very high integer value is added to a numeric value stored in attrVals to denote that it is a percentage value
     */
    static final int VAL_PERCENTAGE = 1 &lt;&lt; 20;
    /**
     * This very high integer value is added to a numeric value stored in attrVals to denote that it is a value in the CSS 'ex' unit (EX means half of the font size)
     */
    static final int VAL_EX = 1 &lt;&lt; 21;
    /**
     * A string array with the attributes supported by the WCSS spec
     * Note that shorthand attributes appear in a different array
     */
<span class="nc" id="L222">    static final String[] CSS_ATTRIBUTE_ROOTS = {</span>
            &quot;background-color&quot;, &quot;background-image&quot;, &quot;background-repeat&quot;, &quot;background-attachment&quot;,
            &quot;background-position-x&quot;, &quot;background-position-y&quot;,
            &quot;border-top-width&quot;, &quot;border-left-width&quot;, &quot;border-bottom-width&quot;, &quot;border-right-width&quot;,
            &quot;border-top-style&quot;, &quot;border-left-style&quot;, &quot;border-bottom-style&quot;, &quot;border-right-style&quot;,
            &quot;border-top-color&quot;, &quot;border-left-color&quot;, &quot;border-bottom-color&quot;, &quot;border-right-color&quot;,
            &quot;clear&quot;, &quot;color&quot;, &quot;vertical-align&quot;, &quot;display&quot;, &quot;float&quot;,
            &quot;font-family&quot;, &quot;font-size&quot;, &quot;font-style&quot;, &quot;font-weight&quot;, &quot;font-variant&quot;,
            &quot;height&quot;, &quot;width&quot;, &quot;visibility&quot;, &quot;white-space&quot;,
            &quot;list-style-image&quot;, &quot;list-style-position&quot;, &quot;list-style-type&quot;,
            &quot;margin-top&quot;, &quot;margin-left&quot;, &quot;margin-bottom&quot;, &quot;margin-right&quot;,
            &quot;padding-top&quot;, &quot;padding-left&quot;, &quot;padding-bottom&quot;, &quot;padding-right&quot;,
            &quot;text-align&quot;, &quot;text-decoration&quot;, &quot;text-indent&quot;, &quot;text-transform&quot;,
            &quot;-wap-access-key&quot;, &quot;-wap-input-format&quot;, &quot;-wap-input-required&quot;,
            &quot;pageurl&quot;, // an attribute used for internal CodenameOne uses
            &quot;border-collapse&quot;, &quot;empty-cells&quot;, &quot;border-spacing&quot;, &quot;caption-side&quot;, &quot;word-spacing&quot;, // css2
            &quot;line-height&quot;, &quot;min-width&quot;, &quot;max-width&quot;, &quot;min-height&quot;, &quot;max-height&quot;, &quot;quotes&quot;, //css2
            &quot;outline-width&quot;, &quot;outline-style&quot;, &quot;outline-color&quot;, // css2
            &quot;content&quot;, &quot;counter-reset&quot;, &quot;counter-increment&quot;, //css2
            &quot;direction&quot; //css2

    };
    /**
     * A string array containing all supported shorthand attributes
     * Shorthand attrributes are mapped to multiple CSS base attributes are used to define several CSS attributes at once
     */
<span class="nc" id="L248">    static final String[] CSS_SHORTHAND_ATTRIBUTE_LIST = {</span>
            &quot;background&quot;,
            &quot;background-position&quot;,
            &quot;border-width&quot;,
            &quot;border-style&quot;,
            &quot;border-color&quot;,
            &quot;border-top&quot;,
            &quot;border-right&quot;,
            &quot;border-bottom&quot;,
            &quot;border-left&quot;,
            &quot;border&quot;,
            &quot;font&quot;,
            &quot;margin&quot;,
            &quot;padding&quot;,
            &quot;list-style&quot;,
            &quot;outline&quot;
    };
    /**
     * A boolean array defining which of the CSS shorthand attributes when defined with less than the expected number of values copy the values defined to the remaining undefined attributes
     * For example, margin expects 4 values (top/right/bottom/left), but can also be defined with 1 value that will be used for all 4, or with 2 values which will be used one for the vertical margins and the other for the horizontal etc.
     */
<span class="nc" id="L269">    static final boolean[] CSS_IS_SHORTHAND_ATTRIBUTE_COLLATABLE = new boolean[]{</span>
            false, // &quot;background&quot;,
            false, // &quot;background-position&quot;,
            true,  // &quot;border-width&quot;,
            true,  // &quot;border-style&quot;,
            true,  // &quot;border-color&quot;,
            false, // &quot;border-top&quot;,
            false, // &quot;border-right&quot;,
            false, // &quot;border-bottom&quot;,
            false, // &quot;border-left&quot;,
            false, // &quot;border&quot;,
            false, // &quot;font&quot;,
            true,  // &quot;margin&quot;,
            true,  // &quot;padding&quot;,
            false,  // &quot;list-style&quot;
            false   // &quot;outline&quot;
    };
    /**
     * A constant representing the focus pseudo-class
     */
    static final int PC_FOCUS = 1;
    /**
     * A constant representing the active pseudo-class
     */
    static final int PC_ACTIVE = 2;
    /**
     * A constant representing the link pseudo-class
     */
    static final int PC_LINK = 4;
    /**
     * A constant representing the visited pseudo-class
     */
    static final int PC_VISITED = 8;
    /**
     * A constant representing the 'before' pseudo-class
     */
    static final int PC_BEFORE = 16;
    /**
     * A constant representing the 'after' pseudo-class
     */
    static final int PC_AFTER = 32;
    /**
     * A constant representing the 'first-child' pseudo-class
     */
    static final int PC_FIRST_CHILD = 64;
    /**
     * The list of strings representing the various CSS pseudo-classes
     */
<span class="nc" id="L317">    final static String[] PSEUDO_CLASSES_STRINGS = {&quot;hover&quot;, &quot;focus&quot;, &quot;active&quot;, &quot;link&quot;, &quot;visited&quot;, &quot;before&quot;, &quot;after&quot;, &quot;first-child&quot;};</span>
    /**
     * The values per each string in PSEUDO_CLASSES_STRINGS
     * Note that 'hover' is mapped to PC_FOCUS since we don't support hover on mobile.
     */
<span class="nc" id="L322">    final static int[] PSEUDO_CLASSES_VALS = {PC_FOCUS, PC_FOCUS, PC_ACTIVE, PC_LINK, PC_VISITED, PC_BEFORE, PC_AFTER, PC_FIRST_CHILD}; // Since we don't have hover in most/all devices we convert hover to focus as well</span>
    /**
     * Defines the Dots-per-Inch - used when CSS length values are denoted in units like inches (in), cm, mm, points (pt) etc.
     * This can be customized per device in build time. However since these units are not mandatory in WCSS so even if this is not accurate no harm done.
     * In any case, always prefer using the supported length units: px, em, ex
     */
    private static final int DPI = 72;
    /**
     * Possible suffix strings for values of the CSS length type
     */
<span class="nc" id="L332">    private final static String[] CSS_LENGTH_SUFFIX = {&quot;px&quot;, &quot;em&quot;, &quot;ex&quot;, &quot;in&quot;, &quot;pt&quot;, &quot;pc&quot;, &quot;mm&quot;, &quot;cm&quot;};</span>
    /**
     * The multiplier values for the suffix strings
     */
<span class="nc" id="L336">    private final static int[] CSS_LENGTH_FACTORS = {1, 2, 1, DPI, DPI / 72, DPI / 6, (int) (DPI / 2.54 / 10), (int) (DPI / 2.54)}; // unit factors for {&quot;px&quot;,&quot;em&quot;,&quot;ex&quot;,&quot;in&quot;,&quot;pt&quot;,&quot;pc&quot;,&quot;mm&quot;,&quot;cm&quot;};</span>
    private final static int LENGTH_SUFFIX_PX = 0;
    private final static int LENGTH_SUFFIX_EM = 1;
    private final static int LENGTH_SUFFIX_EX = 2;
    private final static String CENTER_STR = &quot;center&quot;; // Since this value is used in multiple CSS properties it is defined as a constant
    private static final String CSS_NONE = &quot;none&quot;; // Since this value is used in multiple CSS properties it is defined as a constant
<span class="nc" id="L342">    private static final int[] BG_REPEAT_VALS = {Style.BACKGROUND_IMAGE_TILE_BOTH, Style.BACKGROUND_IMAGE_TILE_HORIZONTAL, Style.BACKGROUND_IMAGE_TILE_VERTICAL, 0};</span>
    // Horizontal alignment strings and their corresponding values
<span class="nc" id="L344">    private static final String[] TEXT_ALIGN_STRINGS = {&quot;left&quot;, &quot;right&quot;, CENTER_STR};</span>
<span class="nc" id="L345">    private static final int[] TEXT_ALIGN_VALS = {Component.LEFT, Component.RIGHT, Component.CENTER};</span>
    // Vertical alignment strings and their corresponding values
<span class="nc" id="L347">    private static final String[] VERTICAL_ALIGN_STRINGS = {&quot;top&quot;, &quot;middle&quot;, &quot;bottom&quot;, &quot;baseline&quot;, &quot;sub&quot;, &quot;super&quot;};</span>
<span class="nc" id="L348">    private static final int[] VERTICAL_ALIGN_VALS = {Component.TOP, Component.CENTER, Component.BOTTOM, -1, -1, -1};</span>
    // Border style strings
<span class="nc" id="L350">    private static final String[] BORDER_STYLE_STRINGS = {CSS_NONE, &quot;solid&quot;, &quot;dotted&quot;, &quot;dashed&quot;, &quot;double&quot;, &quot;groove&quot;, &quot;ridge&quot;, &quot;inset&quot;, &quot;outset&quot;};</span>
    // Border width strings and their corresponding values
<span class="nc" id="L352">    private static final String[] BORDER_WIDTH_STRINGS = {&quot;thin&quot;, &quot;medium&quot;, &quot;thick&quot;};</span>
<span class="nc" id="L353">    private static final int[] BORDER_WIDTH_VALS = {1, 3, 5};</span>
    /**
     * The default border width (when not specified)
     */
<span class="nc" id="L357">    static final int BORDER_DEFAULT_WIDTH = BORDER_WIDTH_VALS[1]; // medium</span>
    // Font size strings and their corresponding values
<span class="nc" id="L359">    private static final String[] FONT_SIZE_STRINGS = {&quot;xx-small&quot;, &quot;x-small&quot;, &quot;small&quot;, &quot;medium&quot;, &quot;large&quot;, &quot;x-large&quot;, &quot;xx-large&quot;, &quot;smaller&quot;, &quot;larger&quot;};</span>
<span class="nc" id="L360">    private static final int[] FONT_SIZE_VALS = {FONT_SIZE_SMALL - 4, FONT_SIZE_SMALL - 2, FONT_SIZE_SMALL, FONT_SIZE_MEDIUM, FONT_SIZE_LARGE, FONT_SIZE_LARGE + 2, FONT_SIZE_LARGE + 4, FONT_SIZE_SMALLER, FONT_SIZE_LARGER};</span>
    // Font style strings and their corresponding values, note that oblique is translated to italic
<span class="nc" id="L362">    private static final String[] FONT_STYLE_STRINGS = {&quot;normal&quot;, &quot;italic&quot;, &quot;oblique&quot;};</span>
<span class="nc" id="L363">    private static final int[] FONT_STYLE_VALS = {Font.STYLE_PLAIN, Font.STYLE_ITALIC, Font.STYLE_ITALIC};</span>
    // Font weight strings and their corresponding values
    // Note that since we have only two levels of boldness (plain, bold) - bolder always means bold, and lighter always means plain
<span class="nc" id="L366">    private static final String[] FONT_WEIGHT_STRINGS = {&quot;normal&quot;, &quot;bold&quot;, &quot;bolder&quot;, &quot;lighter&quot;, &quot;100&quot;, &quot;200&quot;, &quot;300&quot;, &quot;400&quot;, &quot;500&quot;, &quot;600&quot;, &quot;700&quot;, &quot;800&quot;, &quot;900&quot;};</span>
<span class="nc" id="L367">    private static final int[] FONT_WEIGHT_VALS = {Font.STYLE_PLAIN, Font.STYLE_BOLD, Font.STYLE_BOLD, Font.STYLE_PLAIN, Font.STYLE_PLAIN, Font.STYLE_PLAIN, Font.STYLE_PLAIN, Font.STYLE_PLAIN, Font.STYLE_PLAIN, Font.STYLE_BOLD, Font.STYLE_BOLD, Font.STYLE_BOLD, Font.STYLE_BOLD};</span>
    /**
     * Values associated with BG_POS_STRINGS
     */
<span class="nc" id="L371">    private final static int[] BG_POS_PERCENTAGE = {VAL_PERCENTAGE, 50 + VAL_PERCENTAGE, 100 + VAL_PERCENTAGE};</span>
    /**
     * The values of each of the allowed strings.
     * When adding an attribute which its value is an allowed string, the attribute value is set according to this array.
     * For attributes that have no allowed strings (i.e. accpeting numeric values solely) this is not reelvant.
     * For attributes that do have allowed strings and 'null' as the values, it means that the first string in the allowed list will be translated to 0, the second to 1 etc.
     * The purpose of converting strings in strings that have non-null values, is to convert them to a value representing the essence of the string (FOr example thin in border is 1)
     * And for those with null values, is to avoid having to parse strings all the time (so they are conerted to 0,1...,n)
     */
<span class="nc" id="L380">    private static final int[][] CSS_ALLOWED_STRINGS_VALS = {</span>
            null, //TYPE_COLOR, // CSS_BACKGROUND_COLOR
            null, //TYPE_CSS_URL, //CSS_BACKGROUND_IMAGE
            BG_REPEAT_VALS, //TYPE_NMTOKENS, //CSS_BACKGROUND_REPEAT
            null, //{&quot;fixed&quot;,&quot;scroll&quot;}, //TYPE_NMTOKENS, //CSS_BACKGROUND_ATTACHMENT
            BG_POS_PERCENTAGE, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_BACKGROUND_POSITION_X
            BG_POS_PERCENTAGE, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_BACKGROUND_POSITION_Y
            BORDER_WIDTH_VALS, //TYPE_CSS_LENGTH, //CSS_BORDER_TOP_WIDTH
            BORDER_WIDTH_VALS, //TYPE_CSS_LENGTH, //CSS_BORDER_RIGHT_WIDTH
            BORDER_WIDTH_VALS, //TYPE_CSS_LENGTH, //CSS_BORDER_BOTTOM_WIDTH
            BORDER_WIDTH_VALS, //TYPE_CSS_LENGTH, //CSS_BORDER_LEFT_WIDTH
            null, //BORDER_STYLE_VALS, //TYPE_NMTOKENS, //CSS_BORDER_TOP_STYLE
            null, //BORDER_STYLE_VALS, //TYPE_NMTOKENS, //CSS_BORDER_RIGHT_STYLE
            null, //BORDER_STYLE_VALS, //TYPE_NMTOKENS, //CSS_BORDER_BOTTOM_STYLE
            null, //BORDER_STYLE_VALS, //TYPE_NMTOKENS, //CSS_BORDER_LEFT_STYLE
            null, //TYPE_COLOR, //CSS_BORDER_TOP_COLOR
            null, //TYPE_COLOR, // CSS_BORDER_RIGHT_COLOR
            null, //TYPE_COLOR, // CSS_BORDER_BOTTOM_COLOR
            null, //TYPE_COLOR, // CSS_BORDER_LEFT_COLOR
            null, //CLEAR_VALS, //TYPE_NMTOKENS, //CSS_CLEAR
            null, //TYPE_COLOR, // CSS_COLOR
            VERTICAL_ALIGN_VALS, //TYPE_NMTOKENS, //CSS_VERTICAL_ALIGN
            null, //DISPLAY_VALS, //TYPE_NMTOKENS, //CSS_DISPLAY
            null, //FLOAT_VALS, //TYPE_NMTOKENS, //CSS_FLOAT
            null, //TYPE_NMTOKENS, //CSS_FONT_FAMILY
            FONT_SIZE_VALS, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_FONT_SIZE
            FONT_STYLE_VALS, //TYPE_NMTOKENS, //CSS_FONT_STYLE
            FONT_WEIGHT_VALS, //TYPE_NMTOKENS, //CSS_FONT_WEIGHT
            null, //FONT_VARIANT_VALS, //TYPE_NMTOKENS, //CSS_FONT_VARIANT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_HEIGHT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_WIDTH
            null, //VISIBILITY_VALS, //TYPE_NMTOKENS, // CSS_VISIBILITY
            null, //WHITE_SPACE_VALS, //TYPE_NMTOKENS, //CSS_WHITE_SPACE
            null, //TYPE_CSS_URL, //CSS_LIST_STYLE_IMAGE
            null, //LIST_STYLE_POSITION_VALS, //TYPE_NMTOKENS, //CSS_LIST_STYLE_POSITION
            null, //LIST_STYLE_TYPE_VALS, //TYPE_NMTOKENS, //CSS_LIST_STYLE_TYPE
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_TOP
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_RIGHT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_BOTTOM
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_LEFT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_TOP
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_RIGHT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_BOTTOM
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_LEFT
            TEXT_ALIGN_VALS, //TYPE_ALIGN, //CSS_TEXT_ALIGN
            null, //{CSS_NONE}, //TYPE_NMTOKENS, //CSS_TEXT_DECORATION
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_TEXT_INDENT
            null, //TEXT_TRANSFORM_VALS, //TYPE_NMTOKENS, //CSS_TEXT_TRANSFORM
            null, //TYPE_NMTOKENS, // CSS_WAP_ACCESSKEY
            null, //TYPE_NMTOKENS, // CSS_WAP_INPUT_FORMAT
            null, //TYPE_BOOLEAN, // CSS_WAP_INPUT_REQUIRED
            null, //TYPE_NMTOKENS, // baseurl (internal usage)
            null, // CSS_BORDER_COLLAPSE
            null, // CSS_EMPTY_CELLS
            null,// CSS_BORDER_SPACING
            null,// CSS_CAPTION_SIDE
            null, // CSS_WORD_SPACING
            {1}, //CSS_LINE_HEIGHT //normal means 100% of the font height (or 1 * font height)
            null, //CSS_MIN_WIDTH
            null, //CSS_MAX_WIDTH
            null, //CSS_MIN_HEIGHT
            null, //CSS_MAX_HEIGHT
            null, //CSS_QUOTES
            BORDER_WIDTH_VALS, //CSS_OUTLINE_WIDTH
            null, //CSS_OUTLINE_STYLE
            null, //CSS_OUTLINE_COLOR
            null, //CSS_CONTENT
            null, //CSS_COUNTER_RESET
            null, //CSS_COUNTER_INCREMENT
            null,   //CSS_DIRECTION
    };
    /**
     * A constant defining the offset in which the base CSS attribute relating to the TOP appears in the shorthand attribute index
     */
    private static final int CSS_TOP = 0;
    /**
     * An array containing the allowed strings for CSS attributes.
     * Note that these strings are allowed in addition for the allowed values according to the attribute types.
     * Also, unlike the allowed string in Element that are matched per type, here in CSSElement each line matches an attribute (and not its type).
     * This is because of the great variance of allowed strings in CSS that are really per attribute and not per type.
     */
<span class="nc" id="L461">    private static final String[][] CSS_ALLOWED_STRINGS = {</span>
            null, //TYPE_COLOR, // CSS_BACKGROUND_COLOR
            null, //TYPE_CSS_URL, //CSS_BACKGROUND_IMAGE
            BG_REPEAT_STRINGS, //TYPE_NMTOKENS, //CSS_BACKGROUND_REPEAT
            {&quot;fixed&quot;, &quot;scroll&quot;}, //TYPE_NMTOKENS, //CSS_BACKGROUND_ATTACHMENT
            {&quot;left&quot;, CENTER_STR, &quot;right&quot;}, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_BACKGROUND_POSITION_X
            {&quot;top&quot;, CENTER_STR, &quot;bottom&quot;}, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_BACKGROUND_POSITION_Y
            BORDER_WIDTH_STRINGS, //TYPE_CSS_LENGTH, //CSS_BORDER_TOP_WIDTH
            BORDER_WIDTH_STRINGS, //TYPE_CSS_LENGTH, //CSS_BORDER_RIGHT_WIDTH
            BORDER_WIDTH_STRINGS, //TYPE_CSS_LENGTH, //CSS_BORDER_BOTTOM_WIDTH
            BORDER_WIDTH_STRINGS, //TYPE_CSS_LENGTH, //CSS_BORDER_LEFT_WIDTH
            BORDER_STYLE_STRINGS, //TYPE_NMTOKENS, //CSS_BORDER_TOP_STYLE
            BORDER_STYLE_STRINGS, //TYPE_NMTOKENS, //CSS_BORDER_RIGHT_STYLE
            BORDER_STYLE_STRINGS, //TYPE_NMTOKENS, //CSS_BORDER_BOTTOM_STYLE
            BORDER_STYLE_STRINGS, //TYPE_NMTOKENS, //CSS_BORDER_LEFT_STYLE
            null, //TYPE_COLOR, //CSS_BORDER_TOP_COLOR
            null, //TYPE_COLOR, // CSS_BORDER_RIGHT_COLOR
            null, //TYPE_COLOR, // CSS_BORDER_BOTTOM_COLOR
            null, //TYPE_COLOR, // CSS_BORDER_LEFT_COLOR
            {&quot;left&quot;, &quot;right&quot;, CSS_NONE, &quot;both&quot;}, //TYPE_NMTOKENS, //CSS_CLEAR
            null, //TYPE_COLOR, // CSS_COLOR
            VERTICAL_ALIGN_STRINGS, //TYPE_NMTOKENS, //CSS_VERTICAL_ALIGN
            {&quot;inline&quot;, &quot;block&quot;, &quot;list-item&quot;, CSS_NONE, &quot;-wap-marquee&quot;}, //TYPE_NMTOKENS, //CSS_DISPLAY
            {&quot;left&quot;, &quot;right&quot;, CSS_NONE}, //TYPE_NMTOKENS, //CSS_FLOAT
            null, //TYPE_NMTOKENS, //CSS_FONT_FAMILY
            FONT_SIZE_STRINGS, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_FONT_SIZE
            FONT_STYLE_STRINGS, //TYPE_NMTOKENS, //CSS_FONT_STYLE
            FONT_WEIGHT_STRINGS, //TYPE_NMTOKENS, //CSS_FONT_WEIGHT
            {&quot;normal&quot;, SMALL_CAPS_STRING}, //TYPE_NMTOKENS, //CSS_FONT_VARIANT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_HEIGHT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_WIDTH
            {&quot;hidden&quot;, &quot;visible&quot;, &quot;collapse&quot;}, //TYPE_NMTOKENS, // CSS_VISIBILITY
            {&quot;normal&quot;, &quot;pre&quot;, &quot;nowrap&quot;}, //TYPE_NMTOKENS, //CSS_WHITE_SPACE
            null, //TYPE_CSS_URL, //CSS_LIST_STYLE_IMAGE
            {&quot;inside&quot;, &quot;outside&quot;}, //TYPE_NMTOKENS, //CSS_LIST_STYLE_POSITION
            {CSS_NONE, &quot;disc&quot;, &quot;circle&quot;, &quot;square&quot;, &quot;decimal&quot;, &quot;upper-alpha&quot;, &quot;lower-alpha&quot;, &quot;upper-roman&quot;, &quot;lower-roman&quot;}, //TYPE_NMTOKENS, //CSS_LIST_STYLE_TYPE
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_TOP
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_RIGHT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_BOTTOM
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_MARGIN_LEFT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_TOP
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_RIGHT
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_BOTTOM
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_PADDING_LEFT
            TEXT_ALIGN_STRINGS, //TYPE_ALIGN, //CSS_TEXT_ALIGN
            {&quot;underline&quot;, &quot;line-through&quot;, CSS_NONE, &quot;overline&quot;}, //TYPE_NMTOKENS, //CSS_TEXT_DECORATION // 'blink' is not supported, as it is not supported in any major browser
            null, //TYPE_CSS_LENGTH_OR_PERCENTAGE, //CSS_TEXT_INDENT
            {CSS_NONE, &quot;uppercase&quot;, &quot;lowercase&quot;, &quot;capitalize&quot;}, //TYPE_NMTOKENS, //CSS_TEXT_TRANSFORM
            null, //TYPE_NMTOKENS, // CSS_WAP_ACCESSKEY
            null, //TYPE_NMTOKENS, // CSS_WAP_INPUT_FORMAT
            {&quot;true&quot;, &quot;false&quot;}, //TYPE_BOOLEAN, // CSS_WAP_INPUT_REQUIRED
            null, //TYPE_NMTOKENS, // baseurl (internal usage)
            {&quot;collapse&quot;, &quot;separate&quot;}, // CSS_BORDER_COLLAPSE
            {&quot;hide&quot;, &quot;show&quot;}, // CSS_EMPTY_CELLS
            null,// CSS_BORDER_SPACING
            {&quot;bottom&quot;, &quot;top&quot;},// CSS_CAPTION_SIDE
            null, // CSS_WORD_SPACING
            {&quot;normal&quot;}, //CSS_LINE_HEIGHT
            null, //CSS_MIN_WIDTH
            null, //CSS_MAX_WIDTH
            null, //CSS_MIN_HEIGHT
            null, //CSS_MAX_HEIGHT
            null, //CSS_QUOTES
            BORDER_WIDTH_STRINGS, //CSS_OUTLINE_WIDTH
            BORDER_STYLE_STRINGS, //CSS_OUTLINE_STYLE
            null, //CSS_OUTLINE_COLOR
            null, //CSS_CONTENT
            null, //CSS_COUNTER_RESET
            null, //CSS_COUNTER_INCREMENT
            {&quot;rtl&quot;, &quot;ltr&quot;},   //CSS_DIRECTION
    };
    /**
     * A constant defining the offset in which the base CSS attribute relating to the RIGHT appears in the shorthand attribute index
     */
    private static final int CSS_RIGHT = 1;
    /**
     * A constant defining the offset in which the base CSS attribute relating to the BOTTOM appears in the shorthand attribute index
     */
    private static final int CSS_BOTTOM = 2;
    /**
     * A constant defining the offset in which the base CSS attribute relating to the LEFT appears in the shorthand attribute index
     */
    private static final int CSS_LEFT = 3;
    /**
     * A map defining the rules by which values of collatable shorthand attributes are assigned to the base attributes
     * This map is according to the CSS specs
     */
<span class="nc" id="L548">    static final int[][][] CSS_COLLATABLE_ORDER = {</span>
            { // When one value is specified it is set to all sides
                    {CSS_TOP, CSS_RIGHT, CSS_BOTTOM, CSS_LEFT}
            },
            { // When two value are specified:
                    {CSS_TOP, CSS_BOTTOM}, // The first value is set to the top and bottom
                    {CSS_LEFT, CSS_RIGHT}  // The second value is set to the left and right
            },
            { // When three values are specified:
                    {CSS_TOP}, // The first is set to the top
                    {CSS_LEFT, CSS_RIGHT}, // The second is set to the left and right
                    {CSS_BOTTOM} // THe third is set to the bottom
            },
            { // When four values are specified - each is set to the appropriate side
                    {CSS_TOP},
                    {CSS_RIGHT},
                    {CSS_BOTTOM},
                    {CSS_LEFT}
            }
    };
    // The following constants are used in CSS_SHORTHAND_ATTRIBUTE_INDEX when a shorthand attribute translates to a second level of shorthand attributes
    // For example 'border' which translated to width/style/color. The values of the constants denote their location in the CSS_SHORTHAND_ATTRIBUTE_INDEX map
    private static final int CSS_SHORTHAND_BACKGROUND_POSITION = 1;
    private static final int CSS_SHORTHAND_BORDER_WIDTH = 2;
    private static final int CSS_SHORTHAND_BORDER_STYLE = 3;
    private static final int CSS_SHORTHAND_BORDER_COLOR = 4;
    /**
     * A map of CSS shorthand attributes to their corresponding base attributes (or to other shorthand attributes)
     */
<span class="nc" id="L577">    static final int[][] CSS_SHORTHAND_ATTRIBUTE_INDEX = {</span>
            {CSS_BACKGROUND_COLOR, CSS_BACKGROUND_IMAGE, CSS_BACKGROUND_REPEAT, CSS_BACKGROUND_ATTACHMENT, CSS_SHORTHAND_BACKGROUND_POSITION},
            {CSS_BACKGROUND_POSITION_X, CSS_BACKGROUND_POSITION_Y},
            {CSS_BORDER_TOP_WIDTH, CSS_BORDER_RIGHT_WIDTH, CSS_BORDER_BOTTOM_WIDTH, CSS_BORDER_LEFT_WIDTH},
            {CSS_BORDER_TOP_STYLE, CSS_BORDER_RIGHT_STYLE, CSS_BORDER_BOTTOM_STYLE, CSS_BORDER_LEFT_STYLE},
            {CSS_BORDER_TOP_COLOR, CSS_BORDER_RIGHT_COLOR, CSS_BORDER_BOTTOM_COLOR, CSS_BORDER_LEFT_COLOR},
            {CSS_BORDER_TOP_WIDTH, CSS_BORDER_TOP_STYLE, CSS_BORDER_TOP_COLOR},
            {CSS_BORDER_RIGHT_WIDTH, CSS_BORDER_RIGHT_STYLE, CSS_BORDER_RIGHT_COLOR},
            {CSS_BORDER_BOTTOM_WIDTH, CSS_BORDER_BOTTOM_STYLE, CSS_BORDER_BOTTOM_COLOR},
            {CSS_BORDER_LEFT_WIDTH, CSS_BORDER_LEFT_STYLE, CSS_BORDER_LEFT_COLOR},
            {CSS_SHORTHAND_BORDER_WIDTH, CSS_SHORTHAND_BORDER_STYLE, CSS_SHORTHAND_BORDER_COLOR},
            {CSS_FONT_STYLE, CSS_FONT_VARIANT, CSS_FONT_WEIGHT, CSS_FONT_SIZE, CSS_FONT_FAMILY},
            {CSS_MARGIN_TOP, CSS_MARGIN_RIGHT, CSS_MARGIN_BOTTOM, CSS_MARGIN_LEFT},
            {CSS_PADDING_TOP, CSS_PADDING_RIGHT, CSS_PADDING_BOTTOM, CSS_PADDING_LEFT},
            {CSS_LIST_STYLE_TYPE, CSS_LIST_STYLE_POSITION, CSS_LIST_STYLE_IMAGE},
            {CSS_OUTLINE_WIDTH, CSS_OUTLINE_STYLE, CSS_OUTLINE_COLOR}
    };
    /**
     * The attrVals array holds the numeric values of most of the attributes of this element.
     * This is used for quick access, instead of parsing strings in the attributes Hashtable
     * Values are set during addAttribute.
     */
<span class="nc" id="L599">    int[] attrVals = new int[LAST_CSS_PROPERTY_INDEX + 1];</span>
    /**
     * This is true if this selector is a descendant selector - and false if it is a child selector.
     * For example is this selector is h2, and was derived from a 'h1 h2' combo it will be true - but if derived from 'h1 &gt; h2' will be false.
     * Note - for the first selector in the combo (h1 in the above example) this value is not significant and never read.
     */
    boolean descendantSelector;
    /**
     * This is true if this selector is a sibling (adjacent) selector - and false otherwise
     */
    boolean siblingSelector;
    /**
     * A vector holding any attribute selections (For example p[att=value])
     * This will be null in non-attribute selectors.
     */
    Vector attributeSelections;
<span class="nc" id="L615">    private int selectorSpecificity = -1; // A value used to determine how specific this selector is - the more the selector is specific (i.e. id &gt; class &gt; tag) the more it overrides other less specific selectors</span>
<span class="nc" id="L616">    private String selectorId = null; // The selector's ID (if it's an ID selector, i.e. '#someid')</span>
<span class="nc" id="L617">    private String selectorClass = null; // The selector's class (if it's a class selector i.e. '.someclass')</span>
<span class="nc" id="L618">    private String selectorTag = null; // The selector's tag (if it's a tag selector - i.e. 'div')</span>
<span class="nc" id="L619">    private int selectorPseudoClass = 0;</span>

    /**
     * Constructs a CSSElement, This basically sets the name and ID and resets the attrVals array.
     *
     * @param name
     */
<span class="nc" id="L626">    CSSElement(String name) {</span>
<span class="nc" id="L627">        setTagId(TAG_CSS_SELECTOR);</span>
<span class="nc" id="L628">        int index = name.indexOf('[');</span>
<span class="nc" id="L629">        String tagName = name;</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">        if (index != -1) {</span>
<span class="nc" id="L631">            tagName = name.substring(0, index);</span>
            if (HTMLComponent.PROCESS_HTML_MP1_ONLY) { // HTML-MP1 does not supports attribute selectors, so this selector will be ignored
                setTagId(TAG_CSS_ILLEGAL_SELECTOR);
            } else {
<span class="nc bnc" id="L635" title="All 2 branches missed.">                while (index != -1) {</span>
<span class="nc" id="L636">                    int endIndex = name.indexOf(']');</span>
<span class="nc bnc" id="L637" title="All 4 branches missed.">                    if ((endIndex != -1) &amp;&amp; (endIndex &gt; index + 1)) { // non empty (i.e. not [])</span>
<span class="nc" id="L638">                        String str = name.substring(index + 1, endIndex);</span>
<span class="nc" id="L639">                        addAttributeSelection(str);</span>
<span class="nc" id="L640">                    } else {</span>
<span class="nc" id="L641">                        setTagId(TAG_CSS_ILLEGAL_SELECTOR);</span>
<span class="nc" id="L642">                        break;</span>
                    }
<span class="nc" id="L644">                    name = name.substring(endIndex + 1);</span>
<span class="nc" id="L645">                    index = name.indexOf('[');</span>
<span class="nc" id="L646">                }</span>
            }
        }

<span class="nc" id="L650">        setTagName(tagName);</span>
<span class="nc bnc" id="L651" title="All 2 branches missed.">        for (int i = 0; i &lt;= LAST_CSS_PROPERTY_INDEX; i++) {</span>
<span class="nc" id="L652">            attrVals[i] = -1;</span>
        }
<span class="nc" id="L654">    }</span>

    /**
     * Creates this CSSElement as a copy of the given selector
     *
     * @param selector The selector to copy
     */
<span class="nc" id="L661">    CSSElement(CSSElement selector) {</span>
<span class="nc" id="L662">        setTagId(selector.getTagId());</span>
<span class="nc" id="L663">        setTagName(selector.getTagName());</span>
<span class="nc" id="L664">        selector.copyAttributesTo(this);</span>
<span class="nc" id="L665">        descendantSelector = selector.descendantSelector;</span>
<span class="nc" id="L666">        attributeSelections = selector.attributeSelections; // This assumes that there are no modifications to this vector after the copy time</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">        for (int i = 0; i &lt; getNumChildren(); i++) {</span>
<span class="nc" id="L668">            addChild(new CSSElement(selector.getCSSChildAt(i)));</span>
        }
<span class="nc" id="L670">    }</span>

    /**
     * Convenience method with defaultSuffix == LENGTH_SUFFIX_PX
     *
     * @param units The string with CSS units (can be either percentage or px/em/ex and other sufixes from CSS_LENGTH_SUFFIX)
     * @return The value in pixels/font-multipliers/percentage
     */
    static int convertUnitsOrPercentage(String units) {
<span class="nc" id="L679">        return convertUnitsOrPercentage(units, LENGTH_SUFFIX_PX);</span>
    }

    /**
     * Converts the given CSS length/percentage string to pixels
     *
     * @param units         The string with CSS units (can be either percentage or px/em/ex and other sufixes from CSS_LENGTH_SUFFIX)
     * @param defaultSuffix The suffix to use as default if none is specified
     * @return The value in pixels/font-multipliers/percentage
     */
    static int convertUnitsOrPercentage(String units, int defaultSuffix) {
<span class="nc bnc" id="L690" title="All 2 branches missed.">        if (units == null) {</span>
<span class="nc" id="L691">            return -1;</span>
        }

<span class="nc" id="L694">        boolean percentage = false;</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">        if (units.charAt(units.length() - 1) == '%') {</span>
<span class="nc" id="L696">            percentage = true;</span>
<span class="nc" id="L697">            defaultSuffix = LENGTH_SUFFIX_PX; // for percentage, the number without the % is sent and needs to stay as is (factor=1)</span>
<span class="nc" id="L698">            units = units.substring(0, units.length() - 1);</span>
        }

<span class="nc" id="L701">        int val = convertUnits(units, defaultSuffix);</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">        if (percentage) {</span>
<span class="nc" id="L703">            val += VAL_PERCENTAGE;</span>
        }
<span class="nc" id="L705">        return val;</span>
    }

    /**
     * Converts the given CSS length string to pixels
     *
     * @param units         The string with CSS units (can be px/em/ex and other  sufixes from CSS_LENGTH_SUFFIX)
     * @param defaultSuffix The suffix to use as default if none is specified
     * @return the CSS length in pixels
     */
    static int convertUnits(String units, int defaultSuffix) {
<span class="nc bnc" id="L716" title="All 2 branches missed.">        if (units == null) {</span>
<span class="nc" id="L717">            return -1;</span>
        }
<span class="nc" id="L719">        int factor = 1;</span>

<span class="nc" id="L721">        int i = 0;</span>
<span class="nc" id="L722">        boolean suffixFound = false;</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">        for (; i &lt; CSSElement.CSS_LENGTH_SUFFIX.length; i++) {</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">            if (units.endsWith(CSSElement.CSS_LENGTH_SUFFIX[i])) {</span>
<span class="nc" id="L725">                factor = CSS_LENGTH_FACTORS[i];</span>
<span class="nc" id="L726">                units = units.substring(0, units.length() - 2);</span>
<span class="nc" id="L727">                suffixFound = true;</span>
<span class="nc" id="L728">                break;</span>
            }
        }

<span class="nc bnc" id="L732" title="All 2 branches missed.">        if (!suffixFound) {</span>
<span class="nc" id="L733">            i = defaultSuffix;</span>
<span class="nc" id="L734">            factor = CSS_LENGTH_FACTORS[i];</span>
        }


        try {
<span class="nc" id="L739">            int result = (int) (Float.parseFloat(units) * factor);</span>
<span class="nc bnc" id="L740" title="All 4 branches missed.">            if ((i == LENGTH_SUFFIX_EM) || (i == LENGTH_SUFFIX_EX)) { // em &amp; ex</span>
<span class="nc" id="L741">                result += VAL_EX;</span>
            }

<span class="nc" id="L744">            return result;</span>
<span class="nc" id="L745">        } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L746">            return -1;</span>
        }

    }

    static int convertLengthVal(int val, Component cmp, int origDimension) {
<span class="nc bnc" id="L752" title="All 2 branches missed.">        if (val &gt;= 0) { // !=-1 is not enough, since some values as FONT_SMALLER/LARGER are negative and then &amp; VAL_* may be true...</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">            if ((val &amp; VAL_PERCENTAGE) != 0) {</span>
<span class="nc" id="L754">                val -= VAL_PERCENTAGE;</span>
<span class="nc" id="L755">                val = val * origDimension / 100;</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">            } else if ((val &amp; VAL_EX) != 0) { // 'ex' means half of the font size</span>
<span class="nc" id="L757">                val -= VAL_EX;</span>
<span class="nc" id="L758">                val = val * cmp.getStyle().getFont().getHeight() / 2;</span>
            }
        }
<span class="nc" id="L761">        return val;</span>
    }

    /**
     * Adds the given attribute selection
     *
     * @param exp The expression inside the square brackets (for example p[title=test][class] will be parsed in the construvtor and be sent here twice as 'title=test' and then 'class')
     */
    void addAttributeSelection(String exp) {
<span class="nc" id="L770">        int index = exp.indexOf('=');</span>
<span class="nc" id="L771">        String value = null;</span>
<span class="nc" id="L772">        int constraint = AttString.EQUALS;</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">        if (index != -1) {</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">            if (index == 0) { // something lie [=] which is illegal</span>
<span class="nc" id="L775">                setTagId(TAG_CSS_ILLEGAL_SELECTOR);</span>
<span class="nc" id="L776">                return;</span>
            }
<span class="nc" id="L778">            int opIndex = index;</span>
<span class="nc" id="L779">            char c = exp.charAt(index - 1);</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">            if (c == '~') {</span>
<span class="nc" id="L781">                constraint = AttString.CONTAINS_WORD;</span>
<span class="nc" id="L782">                opIndex--;</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">            } else if (c == '|') {</span>
<span class="nc" id="L784">                constraint = AttString.BEGINS_WITH;</span>
<span class="nc" id="L785">                opIndex--;</span>
            }
<span class="nc" id="L787">            value = exp.substring(index + 1);</span>
<span class="nc bnc" id="L788" title="All 4 branches missed.">            if (((value.startsWith(&quot;\&quot;&quot;)) &amp;&amp; (value.endsWith(&quot;\&quot;&quot;))) ||</span>
<span class="nc bnc" id="L789" title="All 4 branches missed.">                    ((value.startsWith(&quot;'&quot;)) &amp;&amp; (value.endsWith(&quot;'&quot;)))) {</span>
<span class="nc" id="L790">                value = value.substring(1, value.length() - 1);</span>
            }

<span class="nc" id="L793">            exp = exp.substring(0, opIndex);</span>
        }
<span class="nc bnc" id="L795" title="All 2 branches missed.">        if (attributeSelections == null) {</span>
<span class="nc" id="L796">            attributeSelections = new Vector();</span>
        }
<span class="nc" id="L798">        attributeSelections.addElement(new AttString(exp, constraint, value));</span>
<span class="nc" id="L799">    }</span>

    /**
     * Overrides Element.getName to return the name string of this CSSElement.
     * Unlike Element which discards the name string and uses the id to identify the name, the CSSElement retains the name and simply returns it here.
     * This is because a CSSElement name is in fact the selector string which is any combination of tags, classes and IDs and as such cannot be converted to a simple int.
     *
     * @return the selector's name
     *
    public String getName() {
    return name;
    }*/

    /**
     * Returns the language code of the specified element (or one of its ancestors)
     * This implementation is optimized for minimal storage but not for performance - each element checks its ancestors for any lang definition
     *
     * @param element The element to check
     * @return The language code of the element, or null if none specified
     */
    private String getLang(HTMLElement element) {
<span class="nc" id="L820">        String lang = element.getAttributeById(HTMLElement.ATTR_LANG);</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">        if (lang != null) {</span>
<span class="nc" id="L822">            return lang;</span>
        } else {
<span class="nc" id="L824">            HTMLElement parent = (HTMLElement) element.getParent();</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">            if (parent != null) {</span>
<span class="nc" id="L826">                return getLang(parent);</span>
            } else {
<span class="nc" id="L828">                return null;</span>
            }

        }
    }

    /**
     * Matches the attribute selections of this selector (if any) to the provided element
     *
     * @param element The element to match to
     * @return true for a match, false otherwise
     */
    boolean matchAttributeSelections(HTMLElement element) {
<span class="nc bnc" id="L841" title="All 2 branches missed.">        if (getTagId() == TAG_CSS_ILLEGAL_SELECTOR) {</span>
<span class="nc" id="L842">            return false;</span>
        }
<span class="nc bnc" id="L844" title="All 2 branches missed.">        if (attributeSelections == null) {</span>
<span class="nc" id="L845">            return true;</span>
        }
<span class="nc bnc" id="L847" title="All 2 branches missed.">        for (Enumeration e = attributeSelections.elements(); e.hasMoreElements(); ) {</span>
<span class="nc" id="L848">            AttString attStr = (AttString) e.nextElement();</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">            if (attStr.constraint == AttString.LANG) {</span>
<span class="nc" id="L850">                String lang = attStr.value;</span>
<span class="nc" id="L851">                String elemLang = getLang(element);</span>
<span class="nc bnc" id="L852" title="All 6 branches missed.">                if ((elemLang == null) || ((!lang.equals(elemLang)) &amp;&amp; (!elemLang.startsWith(lang + &quot;-&quot;)))) {</span>
<span class="nc" id="L853">                    return false;</span>
                }
<span class="nc" id="L855">            } else {</span>
<span class="nc" id="L856">                String elementVal = element.getAttribute(attStr.attribute);</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">                if (elementVal == null) {</span>
<span class="nc" id="L858">                    return false;</span>
                }
<span class="nc bnc" id="L860" title="All 2 branches missed.">                if (attStr.value != null) { //null means if defined it suffices</span>
<span class="nc bnc" id="L861" title="All 4 branches missed.">                    switch (attStr.constraint) {</span>
                        case AttString.EQUALS:
<span class="nc bnc" id="L863" title="All 2 branches missed.">                            if (!elementVal.equals(attStr.value)) {</span>
<span class="nc" id="L864">                                return false;</span>
                            }
                            break;
                        case AttString.BEGINS_WITH:
<span class="nc bnc" id="L868" title="All 4 branches missed.">                            if ((!elementVal.equals(attStr.value)) &amp;&amp; (!elementVal.startsWith(attStr.value + &quot;-&quot;))) {</span>
<span class="nc" id="L869">                                return false;</span>
                            }
                            break;
                        case AttString.CONTAINS_WORD:
<span class="nc" id="L873">                            String str = &quot; &quot; + elementVal + &quot; &quot;; //adding leading and trailing space</span>
<span class="nc bnc" id="L874" title="All 2 branches missed.">                            if (str.indexOf(&quot; &quot; + attStr.value + &quot; &quot;) == -1) { // adding spaces to check for the word and not subword (when we search 'val' we don't want to find 'interval')</span>
<span class="nc" id="L875">                                return false;</span>
                            }
                            break;
                    }
                }
            }

<span class="nc" id="L882">        }</span>
<span class="nc" id="L883">        return true;</span>
    }

    /**
     * Checks if the specified attribute is assigned (i.e. was set with a legal value)
     *
     * @param attrId The attribute ID (Should be one of the CSS attributes, i.e. &gt;= CSS_STYLE_ID_OFFSET)
     * @return true if this attribute is assigned, false otherwise
     */
    boolean isAttributeAssigned(int attrId) {
<span class="nc bnc" id="L893" title="All 6 branches missed.">        return ((attrVals[attrId - CSS_STYLE_ID_OFFSET] != -1) || ((getAttributes() != null) &amp;&amp; (getAttributes().get(Integer.valueOf(attrId)) != null)));</span>
    }

    /**
     * Returns the CSSElement's child positioned at the specified index.
     * This is a convenience method that is very similar to Element.getChildAt, but returns an object of the CSSElement class.
     * Since all of the children of a CSSElement are CSSElements as well, this prevents redundant casting.
     *
     * @param index The requested child position
     * @return The child at the requested position
     * @throws ArrayIndexOutOfBoundsException if the index is bigger than the children's count or smaller than 0
     */
    CSSElement getCSSChildAt(int index) {
<span class="nc" id="L906">        Vector children = getChildren();</span>
<span class="nc bnc" id="L907" title="All 6 branches missed.">        if ((index &lt; 0) || (children == null) || (index &gt;= children.size())) {</span>
<span class="nc" id="L908">            throw new ArrayIndexOutOfBoundsException();</span>
        }
<span class="nc" id="L910">        return (CSSElement) children.elementAt(index);</span>
    }

    /**
     * Adds the specified attribute and value to this CSSElement if it is supported and has a valid value.
     * This method overrides Element.addAttribute to provide with specific CSSElement functionality.
     * Unlike Element which retains all the value strings in the attributes hashtable, In CSSElement the value is immediately converted to a numeric value if possible and placed in the attrVals array.
     * The string is retained only for values that can't be converted to int (such as URLs).
     *
     * @param attribute The attribute's name
     * @param value     The attribute's value
     * @return a positive error code or -1 if attribute is supported and valid
     */
    public int setAttribute(String attribute, String value) {
<span class="nc" id="L924">        int attrId = -1;</span>
<span class="nc" id="L925">        int i = 0;</span>
        //while ((attrId==-1) &amp;&amp; (i&lt;CSS_ATTRIBUTE_ROOTS.length)) {
<span class="nc bnc" id="L927" title="All 4 branches missed.">        while ((attrId == -1) &amp;&amp; (i &lt;= LAST_CSS_PROPERTY_INDEX)) {</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">            if (CSS_ATTRIBUTE_ROOTS[i].equals(attribute)) {</span>
<span class="nc" id="L929">                attrId = CSS_STYLE_ID_OFFSET + i;</span>
<span class="nc" id="L930">                break;</span>
            } else {
<span class="nc" id="L932">                i++;</span>
            }
        }

<span class="nc bnc" id="L936" title="All 2 branches missed.">        if (attrId == -1) {</span>
<span class="nc" id="L937">            return HTMLCallback.ERROR_CSS_ATTRIBUTE_NOT_SUPPORTED;</span>
        } else {
<span class="nc" id="L939">            return addAttribute(attrId, value);</span>

        }
    }

    /**
     * Adds the specified attribute and value to this CSSElement if it is supported and has a valid value.
     * This method is used by addAttribute(String,String) and also when we already know the attribute's id (Such as in shorthand attributes)
     *
     * @param attrId The attribute's id
     * @param value  The attribute's value
     * @return a positive error code or -1 if attribute is supported and valid
     */
    int addAttribute(int attrId, String value) {

<span class="nc bnc" id="L954" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L955">            return HTMLCallback.ERROR_ATTIBUTE_VALUE_INVALID;</span>
        }
<span class="nc" id="L957">        int i = attrId - CSS_STYLE_ID_OFFSET;</span>

<span class="nc" id="L959">        boolean knownType = true;</span>
<span class="nc" id="L960">        int val = -1;</span>

<span class="nc bnc" id="L962" title="All 5 branches missed.">        switch (CSS_ATTRIBUTE_TYPES[i]) {</span>
            case TYPE_COLOR:
<span class="nc" id="L964">                val = getColor(value, -1);</span>
<span class="nc" id="L965">                break;</span>
            case TYPE_CSS_LENGTH:
<span class="nc" id="L967">                val = convertUnits(value, LENGTH_SUFFIX_PX);</span>
<span class="nc" id="L968">                break;</span>
            case TYPE_CSS_LENGTH_OR_PERCENTAGE:
<span class="nc" id="L970">                val = convertUnitsOrPercentage(value, LENGTH_SUFFIX_PX);</span>
<span class="nc" id="L971">                break;</span>
            case TYPE_CSS_LENGTH_OR_PERCENTAGE_OR_MULTIPLIER:
<span class="nc" id="L973">                val = convertUnitsOrPercentage(value, LENGTH_SUFFIX_EM);</span>
<span class="nc" id="L974">                break;</span>
            default:
<span class="nc" id="L976">                knownType = false;</span>
        }
<span class="nc bnc" id="L978" title="All 2 branches missed.">        if (val == -1) { // Some attributes can be either a number, or a string. For example border-width may be a number/percentage but can also be &quot;thin&quot;/&quot;medium&quot;/&quot;thick&quot; which is translated by the strings</span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">            if (CSS_ALLOWED_STRINGS[i] != null) {</span>
<span class="nc" id="L980">                val = HTMLUtils.getStringVal(value, CSS_ALLOWED_STRINGS[i], CSS_ALLOWED_STRINGS_VALS[i]);</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">                if (val == -1) {</span>
<span class="nc" id="L982">                    return HTMLCallback.ERROR_ATTIBUTE_VALUE_INVALID;</span>
                } else {
<span class="nc" id="L984">                    attrVals[i] = val;</span>
<span class="nc" id="L985">                    fixBackgroundPositionDefaults(attrId);</span>
                }
            } else {
<span class="nc bnc" id="L988" title="All 2 branches missed.">                if (knownType) {</span>
<span class="nc" id="L989">                    return HTMLCallback.ERROR_ATTIBUTE_VALUE_INVALID;</span>
                } else {
<span class="nc" id="L991">                    setAttribute(Integer.valueOf(attrId), value);</span>
                }
            }
        } else {
<span class="nc" id="L995">            attrVals[i] = val;</span>
<span class="nc" id="L996">            fixBackgroundPositionDefaults(attrId);</span>
        }

<span class="nc" id="L999">        return -1; // No error code - attribute addition succeeded</span>
    }

    /**
     * Checks if the attribute is one of CSS_BACKGROUND_POSITION_X or CSS_BACKGROUND_POSITION_Y and if so fixes the default of the other attribute accordingly.
     * Background position is a very special case, since when it is not specified the default is TOP, LEFT, but when one of the background positions is specified, the other's default turns to CENTER
     *
     * @param attrId The attributeID
     */
    private void fixBackgroundPositionDefaults(int attrId) {
<span class="nc bnc" id="L1009" title="All 4 branches missed.">        if ((attrId == CSS_BACKGROUND_POSITION_X) &amp;&amp; (!isAttributeAssigned(CSS_BACKGROUND_POSITION_Y))) {</span>
<span class="nc" id="L1010">            addAttribute(CSS_BACKGROUND_POSITION_Y, CENTER_STR);</span>
<span class="nc bnc" id="L1011" title="All 4 branches missed.">        } else if ((attrId == CSS_BACKGROUND_POSITION_Y) &amp;&amp; (!isAttributeAssigned(CSS_BACKGROUND_POSITION_X))) {</span>
<span class="nc" id="L1012">            addAttribute(CSS_BACKGROUND_POSITION_X, CENTER_STR);</span>
        }
<span class="nc" id="L1014">    }</span>

    /**
     * {{@inheritDoc}}
     */
    public String getAttributeName(Integer attrKey) {
<span class="nc" id="L1020">        return CSS_ATTRIBUTE_ROOTS[attrKey.intValue() - CSS_STYLE_ID_OFFSET];</span>
    }

    /**
     * Returns this selector's specificity. A specificity of a selector determines the order in which it should be applied.
     * The bigger the specificty, the later the selector will be applied (Which means it will overdride previously applied selectors)
     * This lazily invokes calcSelectorSpecificity if it wasn't invoked before.
     *
     * @return this selector's specificity.
     */
    int getSelectorSpecificity() {
<span class="nc bnc" id="L1031" title="All 2 branches missed.">        if (selectorSpecificity == -1) {</span>
<span class="nc" id="L1032">            selectorSpecificity = calcSelectorSpecificity();</span>
        }
<span class="nc" id="L1034">        return selectorSpecificity;</span>

    }

    /**
     * Returns the value of the requested attribute
     *
     * @param attrId The attribute's id
     * @return the value of the requested attribute
     */
    int getAttrVal(int attrId) {
<span class="nc" id="L1045">        return attrVals[attrId - CSS_STYLE_ID_OFFSET];</span>
    }

    /**
     * Returns the length value of the requested attribute.
     * A CSS length value can be denoted in various units, or percentages. This method calculates the final value in pixels.
     *
     * @param attrId        The attribute's id
     * @param cmp           The component relevant to the length calculation (Used in case of length values based on font size)
     * @param origDimension The original dimension to take into account if the value is specified as a percentage value
     * @return the calculated value
     */
    int getAttrLengthVal(int attrId, Component cmp, int origDimension) {
<span class="nc" id="L1058">        int val = getAttrVal(attrId);</span>
<span class="nc" id="L1059">        return convertLengthVal(val, cmp, origDimension);</span>
    }

    /**
     * Calculates this selector's specificity
     *
     * @return this selector's specificity
     */
    int calcSelectorSpecificity() {
<span class="nc" id="L1068">        int spec = 0;</span>
<span class="nc bnc" id="L1069" title="All 2 branches missed.">        if (attributeSelections != null) {</span>
<span class="nc" id="L1070">            spec += attributeSelections.size(); // attribute selectors get extra specificity points, same as pseudo classes</span>
        }

<span class="nc" id="L1073">        String nameStr = getTagName();</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">        if (nameStr.startsWith(&quot;*&quot;)) {</span>
<span class="nc" id="L1075">            nameStr = nameStr.substring(1); //ignore universal selector</span>
        }

<span class="nc" id="L1078">        int index = nameStr.lastIndexOf(':');</span>
<span class="nc bnc" id="L1079" title="All 2 branches missed.">        while (index != -1) {</span>
<span class="nc" id="L1080">            String property = nameStr.substring(index + 1);</span>
<span class="nc" id="L1081">            nameStr = nameStr.substring(0, index);</span>
<span class="nc" id="L1082">            int propNum = HTMLUtils.getStringVal(property, PSEUDO_CLASSES_STRINGS, PSEUDO_CLASSES_VALS);</span>
<span class="nc bnc" id="L1083" title="All 2 branches missed.">            if (propNum != -1) {</span>
<span class="nc" id="L1084">                selectorPseudoClass += propNum;</span>
<span class="nc" id="L1085">                spec++; // Psuedo-classes get extra specificity points</span>
<span class="nc bnc" id="L1086" title="All 2 branches missed.">            } else if ((!HTMLComponent.PROCESS_HTML_MP1_ONLY) &amp;&amp; (property.startsWith(&quot;lang(&quot;))) { // Though :lang is a pseudo-class, we implement it internally as an attribute selection, since it needs to hold a string value (the langauge string)</span>
<span class="nc" id="L1087">                String lang = property.substring(5, property.length() - 1);</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">                if (attributeSelections == null) {</span>
<span class="nc" id="L1089">                    attributeSelections = new Vector();</span>
                }
<span class="nc" id="L1091">                attributeSelections.addElement(new AttString(null, AttString.LANG, lang));</span>
<span class="nc" id="L1092">                spec++;</span>

            }
<span class="nc" id="L1095">            index = nameStr.lastIndexOf(':');</span>
<span class="nc" id="L1096">        }</span>
<span class="nc bnc" id="L1097" title="All 2 branches missed.">        if (((selectorPseudoClass &amp; (PC_FOCUS | PC_ACTIVE | PC_LINK | PC_VISITED)) != 0)</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">                &amp;&amp; (nameStr.length() == 0)) { // :link is the same as a:link</span>
<span class="nc" id="L1099">            nameStr = &quot;a&quot;;</span>
        }
        //name=nameStr; // The tag name should not contain the pseudo classes
<span class="nc" id="L1102">        setTagName(nameStr); // The tag name should not contain the pseudo classes</span>

<span class="nc" id="L1104">        index = nameStr.indexOf('#');</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        if (index != -1) {</span>
<span class="nc" id="L1106">            spec += 100;</span>
<span class="nc" id="L1107">            selectorId = nameStr.substring(index + 1);</span>
<span class="nc bnc" id="L1108" title="All 2 branches missed.">            if (index != 0) {</span>
<span class="nc" id="L1109">                spec += 1;</span>
<span class="nc" id="L1110">                selectorTag = nameStr.substring(0, index);</span>
            }
        } else {
<span class="nc" id="L1113">            index = nameStr.indexOf('.');</span>
<span class="nc bnc" id="L1114" title="All 2 branches missed.">            if (index != -1) {</span>
<span class="nc" id="L1115">                spec += 10;</span>
<span class="nc" id="L1116">                selectorClass = nameStr.substring(index + 1);</span>
                //selectorClass=selectorClass.replace('.', ' ');

<span class="nc bnc" id="L1119" title="All 2 branches missed.">                if (index != 0) {</span>
<span class="nc" id="L1120">                    spec += 1;</span>
<span class="nc" id="L1121">                    selectorTag = nameStr.substring(0, index);</span>
                }
            } else {
<span class="nc bnc" id="L1124" title="All 2 branches missed.">                if (nameStr.length() &gt; 0) {</span>
<span class="nc" id="L1125">                    spec += 1;</span>
<span class="nc" id="L1126">                    selectorTag = nameStr;</span>
                }
            }
        }

<span class="nc bnc" id="L1131" title="All 2 branches missed.">        for (int i = 0; i &lt; getNumChildren(); i++) { // There should be usually just one child</span>
<span class="nc" id="L1132">            spec += (getCSSChildAt(i)).getSelectorSpecificity();</span>
        }

<span class="nc" id="L1135">        return spec;</span>
    }

    /**
     * Returns this selector's id, or null if none
     * This method assumes that calcSelectorSpecificity was invoked before.
     *
     * @return this selector's id, or null if none
     */
    String getSelectorId() {
<span class="nc" id="L1145">        return selectorId;</span>
    }

    /**
     * Returns this selector's class, or null if none
     * This method assumes that calcSelectorSpecificity was invoked before.
     *
     * @return this selector's class, or null if none
     */
    String getSelectorClass() {
<span class="nc" id="L1155">        return selectorClass;</span>
    }

    /**
     * Returns this selector's tag, or null if none
     * This method assumes that calcSelectorSpecificity was invoked before.
     *
     * @return this selector's tag, or null if none
     */
    String getSelectorTag() {
<span class="nc" id="L1165">        return selectorTag;</span>
    }

    /**
     * This method assumes that calcSelectorSpecificity was invoked before.
     *
     * @return the selectorPseudoClass
     */
    int getSelectorPseudoClass() {
<span class="nc" id="L1174">        return selectorPseudoClass;</span>
    }

    /**
     * Copies all properties, both string and numeric values to the destination element
     * This is used for grouped selectors
     *
     * @param dest The destination selector
     */
    void copyAttributesTo(CSSElement dest) {
<span class="nc" id="L1184">        System.arraycopy(attrVals, 0, dest.attrVals, 0, attrVals.length);</span>
<span class="nc" id="L1185">        Hashtable attributes = getAttributes();</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">        if (attributes != null) {</span>
<span class="nc bnc" id="L1187" title="All 2 branches missed.">            for (Enumeration e = attributes.keys(); e.hasMoreElements(); ) {</span>
<span class="nc" id="L1188">                Integer key = (Integer) e.nextElement();</span>
<span class="nc" id="L1189">                String value = (String) attributes.get(key);</span>
<span class="nc" id="L1190">                dest.setAttribute(key, value);</span>
<span class="nc" id="L1191">            }</span>
        }
<span class="nc" id="L1193">    }</span>

    /**
     * Simple data class to hold a data to be used for attribute selections
     *
     * @author Ofir Leitner
     */
    class AttString {

        static final int EQUALS = 0;
        static final int BEGINS_WITH = 1;
        static final int CONTAINS_WORD = 2;
        static final int LANG = 3;

        String attribute;
        String value;
        int constraint;

<span class="nc" id="L1211">        AttString(String attribute, int constraint, String value) {</span>
<span class="nc" id="L1212">            this.attribute = attribute;</span>
<span class="nc" id="L1213">            this.constraint = constraint;</span>
<span class="nc" id="L1214">            this.value = value;</span>
<span class="nc" id="L1215">        }</span>

    }

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>